parameters:
  environmentName: ""
  azureSubscription: ""
  AcrName: ""
  ImageRepo: ""

steps:
  - task: AzureCLI@2
    displayName: "Deploy to Azure Container App"
    inputs:
      azureSubscription: ${{ parameters.azureSubscription }}
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        set -e

        IMAGE="${{ parameters.AcrName }}.azurecr.io/${{ parameters.ImageRepo }}:$(Build.BuildId)"

        az containerapp update \
          --name "$(ContainerAppName)" \
          --resource-group "$(ResourceGroupName)" \
          --image "$IMAGE" \
          --set-env-vars \
              ENVIRONMENT=${ENVIRONMENT} \
              DATABASE_URL=$(DATABASE_URL) \
              REDIS_URL=$(REDIS_URL) \
              AZURE_TENANT_ID=${AZURE_TENANT_ID} \
              AZURE_CLIENT_ID=${AZURE_CLIENT_ID} \
              USE_MANAGED_IDENTITY=${USE_MANAGED_IDENTITY} \
