# プロジェクト概要

このドキュメントでは、プロジェクト全体の構成を高レベルで理解します。

---

## プロジェクトの目的

このプロジェクトは、**FastAPI + LangChain/LangGraphによるAIエージェントアプリケーション**のバックエンドAPIです。

主な機能:

- ユーザー認証・認可（JWT）
- AIエージェントとの対話セッション管理
- ファイルアップロード・管理
- RESTful API提供

---

## 技術スタック概要

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| **Webフレームワーク** | FastAPI | 高速なREST API構築 |
| **データベース** | PostgreSQL | メインデータストア |
| **キャッシュ** | Redis | セッション・レート制限 |
| **ORM** | SQLAlchemy | データベース操作 |
| **AI** | LangChain/LangGraph | AIエージェント実装 |
| **認証** | JWT + bcrypt | セキュアな認証 |

---

## ディレクトリ構造の概要

```text
src/app/
├── api/              # APIエンドポイント定義
├── models/           # データベースモデル（テーブル定義）
├── schemas/          # Pydanticスキーマ（バリデーション）
├── repositories/     # データアクセス層
├── services/         # ビジネスロジック層
├── core/             # 設定・セキュリティ・例外
└── middlewares/      # HTTPミドルウェア
```

---

## アーキテクチャの階層

このプロジェクトは**4層アーキテクチャ**を採用しています:

```text
┌─────────────────────────┐
│   API層 (api/)          │  ← HTTPリクエスト受付
├─────────────────────────┤
│   サービス層 (services/)│  ← ビジネスロジック
├─────────────────────────┤
│ リポジトリ層 (repos/)   │  ← データアクセス
├─────────────────────────┤
│   モデル層 (models/)    │  ← データベーステーブル
└─────────────────────────┘
```

**各層の役割**:

- **API層**: エンドポイント定義、リクエスト検証、レスポンス返却
- **サービス層**: ビジネスロジック、トランザクション管理
- **リポジトリ層**: データベースCRUD操作
- **モデル層**: テーブル構造定義、リレーション定義

---

## データフロー例

ユーザー登録のリクエストがどのように処理されるか:

```text
1. クライアント → POST /api/v1/sample-users/register
                   ↓
2. API層 (routes/v1/sample_users.py)
   - リクエストボディをバリデーション (Pydanticスキーマ)
                   ↓
3. サービス層 (services/sample_user.py)
   - パスワード強度チェック
   - パスワードをbcryptでハッシュ化
   - メールアドレス重複チェック
                   ↓
4. リポジトリ層 (repositories/sample_user.py)
   - データベースにINSERT
                   ↓
5. モデル層 (models/sample_user.py)
   - SampleUserテーブルに保存
                   ↓
6. レスポンス ← 201 Created + ユーザー情報（パスワード除く）
```

---

## 主要な機能モジュール

### 1. ユーザー認証 (`sample_users`)

- ユーザー登録・ログイン
- JWT トークン発行・検証
- パスワード強度検証
- リフレッシュトークン
- APIキー生成

### 2. AIエージェント (`sample_agents`)

- エージェント作成・管理
- LangGraph ワークフロー実行
- プロンプト管理

### 3. セッション管理 (`sample_sessions`)

- 対話セッション作成
- メッセージ履歴保存
- セッション一覧・検索

### 4. ファイル管理 (`sample_files`)

- ファイルアップロード
- Azure Blob Storage連携
- ファイル一覧・削除

---

## セキュリティ機能

- **パスワードハッシュ化**: bcrypt（コスト12ラウンド）
- **JWT認証**: HS256署名、有効期限管理
- **CORS設定**: オリジン制限
- **レート制限**: Redisベース
- **入力バリデーション**: Pydantic自動検証
- **SQLインジェクション対策**: SQLAlchemy ORM使用

---

## 開発環境

- **Python**: 3.13
- **パッケージマネージャ**: uv（高速な依存関係管理）
- **データベース**: PostgreSQL（ローカルインストール）
- **キャッシュ**: Redis（オプション）
- **VSCode**: 推奨エディタ（拡張機能設定済み）
- **Linter/Formatter**: Ruff（高速なPythonツール）

---

## 次のステップ

このプロジェクト概要を理解したら、次はアーキテクチャの詳細を学びましょう:

1. **[プロジェクト構造](../02-architecture/01-project-structure.md)** - ディレクトリ構造の詳細
2. **[レイヤードアーキテクチャ](../02-architecture/02-layered-architecture.md)** - 4層アーキテクチャの詳細
3. **[依存性注入](../02-architecture/03-dependency-injection.md)** - FastAPI DIの使い方

---

## 関連ドキュメント

- [前提条件](./01-prerequisites.md) - 開発環境の準備
- [Windows環境セットアップ](./02-windows-setup.md) - PostgreSQL、Python、uvのインストール
- [クイックスタート](./05-quick-start.md) - 最速でAPIを起動
