# プロジェクト管理 フロントエンド設計書

## 1. フロントエンド設計

### 1.1 画面一覧

| 画面ID | 画面名 | パス | 説明 |
|--------|-------|------|------|
| projects | プロジェクト一覧 | `/projects` | プロジェクト一覧表示・検索 |
| project-new | プロジェクト作成 | `/projects/new` | 新規プロジェクト作成フォーム |
| project-detail | プロジェクト詳細 | `/projects/{id}` | プロジェクト詳細・統計表示 |
| members | メンバー管理 | `/projects/{id}/members` | メンバー一覧・追加・削除 |
| files | ファイル管理 | `/projects/{id}/files` | ファイル一覧・アップロード |
| upload | ファイルアップロード | `/projects/{id}/upload` | ファイルアップロード画面 |

### 1.2 コンポーネント構成

```text
pages/projects/
├── index.tsx              # プロジェクト一覧
├── new.tsx                # プロジェクト作成
└── [id]/
    ├── index.tsx          # プロジェクト詳細
    ├── members.tsx        # メンバー管理
    ├── files.tsx          # ファイル管理
    └── upload.tsx         # ファイルアップロード
```

---

## 2. 画面詳細設計

### 2.1 プロジェクト一覧画面（projects）

#### 検索・フィルタ項目

| 画面項目 | 入力形式 | APIエンドポイント | クエリパラメータ | 備考 |
|---------|---------|------------------|-----------------|------|
| プロジェクト名検索 | テキスト | `GET /api/v1/project` | - | フロントでフィルタ |
| ステータスフィルタ | セレクト | 同上 | `is_active` | true/false/null |

#### 一覧表示項目

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| プロジェクト名 | テキスト(strong) | `GET /api/v1/project` | `projects[].name` | - |
| 説明 | テキスト | 同上 | `projects[].description` | 切り詰め表示 |
| メンバー数 | 数値 | 同上 | `projects[].stats.memberCount` | - |
| ステータス | バッジ | 同上 | `projects[].isActive` | `true`→"有効"(success), `false`→"アーカイブ"(secondary) |
| 作成日 | 日付 | 同上 | `projects[].createdAt` | ISO8601→YYYY/MM/DD |
| 編集ボタン | ボタン | - | - | 編集モーダル表示 |
| アーカイブ/復元ボタン | ボタン | `PATCH /api/v1/project/{id}` | `isActive` | 状態により切替 |

#### ページネーション

| 画面項目 | 表示形式 | APIエンドポイント | クエリパラメータ | 備考 |
|---------|---------|------------------|-----------------|------|
| 表示件数選択 | セレクト | `GET /api/v1/project` | `limit` | 10/25/50/100件 |
| ページ番号 | ボタン | 同上 | `skip`, `limit` | `skip = (page - 1) × limit` |
| 前へ/次へボタン | ボタン | 同上 | `skip`, `limit` | ページ移動 |
| 総件数表示 | テキスト | 同上 | レスポンス `total` | "X件中Y-Z件を表示" |

### 2.2 プロジェクト作成画面（project-new）

#### 入力項目

| 画面項目 | 入力形式 | 必須 | APIエンドポイント | リクエストフィールド | バリデーション |
|---------|---------|-----|------------------|---------------------|---------------|
| プロジェクト名 | テキスト | ✓ | `POST /api/v1/project` | `name` | 1-255文字 |
| 説明 | テキストエリア | - | 同上 | `description` | - |
| 開始日 | 日付 | - | 同上 | `startDate` | - |
| 終了予定日 | 日付 | - | 同上 | `endDate` | 開始日以降 |
| 初期メンバー | 複数選択 | - | 別途メンバー追加API | - | - |

### 2.3 プロジェクト詳細画面（project-detail）

#### レイアウト構成

| エリア | 説明 | 幅 |
|--------|------|-----|
| メインエリア | プロジェクト概要・統計・セッション・ツリー一覧 | 70% |
| サイドバー | ファイル一覧・アップロード | 30% |

#### プロジェクト概要セクション

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| プロジェクト名 | タイトル | `GET /api/v1/project/{id}` | `name` | - |
| ステータス | バッジ | 同上 | `isActive` | boolean→バッジ |
| 説明 | テキスト | 同上 | `description` | - |
| 作成日 | 日付 | 同上 | `createdAt` | YYYY年MM月DD日 |
| 開始日 | 日付 | 同上 | `startDate` | YYYY年MM月DD日 |
| 終了予定日 | 日付 | 同上 | `endDate` | YYYY年MM月DD日 |
| 作成者 | テキスト | 同上 | `createdBy` | ユーザー名取得必要 |
| 編集ボタン | ボタン | - | - | 編集モーダル表示 |

#### 統計セクション

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 備考 |
|---------|---------|------------------|---------------------|------|
| セッション数 | 数値 | `GET /api/v1/project/{id}` | `stats.sessionCount` | - |
| スナップショット数 | 数値 | 同上 | 別途計算 | - |
| ツリー数 | 数値 | 同上 | `stats.treeCount` | - |
| ファイル数 | 数値 | 同上 | `stats.fileCount` | - |

#### 分析セッション一覧セクション

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| セッション名 | テキスト(Link) | `GET /api/v1/project/{id}/session` | `sessions[].name` | クリックでセッション詳細へ |
| 現在の課題 | テキスト | 同上 | `sessions[].currentChallenge` | - |
| スナップショット数 | 数値 | 同上 | `sessions[].snapshotCount` | - |
| 更新日時 | 日付 | 同上 | `sessions[].updatedAt` | ISO8601→YYYY/MM/DD HH:mm |
| 詳細ボタン | ボタン | - | - | セッション詳細画面へ遷移 |

**API連携**:
- プロジェクト詳細取得時に `stats.sessionCount` で件数を表示
- セッション一覧は別途 `GET /api/v1/project/{project_id}/session` で取得
- 初期表示は最新5件、「すべて表示」でセッション一覧画面へ

#### ドライバーツリー一覧セクション

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| ツリー名 | テキスト(Link) | `GET /api/v1/project/{id}/tree` | `trees[].name` | クリックでツリー詳細へ |
| ノード数 | 数値 | 同上 | `trees[].nodeCount` | - |
| 施策数 | 数値 | 同上 | `trees[].actionCount` | - |
| 更新日時 | 日付 | 同上 | `trees[].updatedAt` | ISO8601→YYYY/MM/DD HH:mm |
| 詳細ボタン | ボタン | - | - | ツリー詳細画面へ遷移 |

**API連携**:
- プロジェクト詳細取得時に `stats.treeCount` で件数を表示
- ツリー一覧は別途 `GET /api/v1/project/{project_id}/tree` で取得
- 初期表示は最新5件、「すべて表示」でツリー一覧画面へ

#### プロジェクト編集モーダル

| 画面項目 | 入力形式 | 必須 | APIエンドポイント | リクエストフィールド | バリデーション |
|---------|---------|-----|------------------|---------------------|---------------|
| プロジェクト名 | テキスト | ✓ | `PATCH /api/v1/project/{id}` | `name` | 1-255文字 |
| 説明 | テキストエリア | - | 同上 | `description` | - |
| 開始日 | 日付 | - | 同上 | `startDate` | - |
| 終了予定日 | 日付 | - | 同上 | `endDate` | 開始日以降 |
| ステータス | トグル | - | 同上 | `isActive` | true/false |
| 保存ボタン | ボタン | - | - | - | 必須項目チェック |
| キャンセルボタン | ボタン | - | - | - | モーダル閉じる |

**モーダル動作**:
- 編集ボタンクリックで現在の値を設定して表示
- 保存時は `PATCH /api/v1/project/{id}` で更新
- 成功時はモーダルを閉じて詳細画面を再読み込み

### 2.4 メンバー管理画面（members）

#### タブ構成

| タブ名 | 説明 | デフォルト |
|--------|------|-----------|
| メンバー一覧 | 現在のプロジェクトメンバー一覧 | ✓ |
| 招待履歴 | メンバー招待・追加履歴 | - |

#### メンバー一覧タブ

##### 一覧表示項目

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| ユーザー（アイコン+名前） | アイコン+テキスト | `GET /api/v1/project/{id}/member` | `members[].user.displayName` | - |
| メールアドレス | テキスト | 同上 | `members[].user.email` | - |
| ロール | バッジ | 同上 | `members[].role` | ロール名→バッジ色 |
| 追加日 | 日付 | 同上 | `members[].joinedAt` | ISO8601→YYYY/MM/DD |
| ロール変更 | セレクト | `PATCH .../member/{id}` | `role` | PM以外表示 |
| 削除ボタン | ボタン | `DELETE .../member/{id}` | - | 作成者は削除不可 |

##### ロール色マッピング

| ロール | バッジ色 | 説明 |
|--------|---------|------|
| project_manager | info | プロジェクト管理者 |
| project_moderator | warning | モデレーター |
| member | success | 一般メンバー |
| viewer | neutral | 閲覧者 |

##### メンバー追加モーダル

| 画面項目 | 入力形式 | 必須 | APIエンドポイント | リクエストフィールド | バリデーション |
|---------|---------|-----|------------------|---------------------|---------------|
| ユーザー選択 | セレクト | ✓ | `POST /api/v1/project/{id}/member` | `userId` | 既存メンバー除外 |
| ロール | セレクト | ✓ | 同上 | `role` | 有効なロール値 |

#### 招待履歴タブ

##### 履歴表示項目

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| 追加者 | テキスト | `GET /api/v1/project/{id}/member/history` | `history[].addedBy.displayName` | - |
| 追加されたユーザー | テキスト | 同上 | `history[].user.displayName` | - |
| ロール | バッジ | 同上 | `history[].role` | ロール名→バッジ色 |
| 追加日時 | 日付 | 同上 | `history[].joinedAt` | ISO8601→YYYY/MM/DD HH:mm |
| ステータス | バッジ | 同上 | `history[].status` | active/removed |

**ステータス表示**:
- `active`: "現在のメンバー"（success）
- `removed`: "削除済み"（secondary）

**API連携**:
- メンバー追加履歴は `GET /api/v1/project/{project_id}/member/history` で取得
- 削除されたメンバーも履歴に含む
- 追加日時の降順でソート

### 2.5 ファイル管理サイドバー

#### ファイル一覧

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| ファイルアイコン | アイコン | `GET /api/v1/project/{id}/file` | `files[].mimeType` | MIMEタイプ→アイコン |
| ファイル名 | テキスト | 同上 | `files[].originalFilename` | - |
| サイズ・日付 | テキスト | 同上 | `files[].fileSize`, `files[].createdAt` | バイト→KB/MB, MM/DD |

#### ファイルアイコンマッピング

| MIMEタイプ | アイコン |
|-----------|---------|
| application/vnd.* (Excel) | 📊 |
| text/csv | 📄 |
| application/pdf | 📕 |
| image/* | 🖼️ |
| その他 | 📎 |
