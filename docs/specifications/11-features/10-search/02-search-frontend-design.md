# グローバル検索 フロントエンド設計書

## 1. フロントエンド設計

### 1.1 画面一覧

| 画面ID | 画面名 | パス | 説明 |
|--------|--------|------|------|
| - | ヘッダー検索（コンポーネント） | 全ページ共通 | グローバル検索UI |

### 1.2 コンポーネント構成

```text
features/search/
├── components/
│   ├── GlobalSearch/
│   │   ├── GlobalSearch.tsx
│   │   ├── SearchInput.tsx
│   │   ├── SearchDropdown.tsx
│   │   ├── SearchResultItem.tsx
│   │   └── SearchShortcut.tsx
│   └── SearchFilters/
│       ├── TypeFilter.tsx
│       └── ProjectFilter.tsx
├── hooks/
│   ├── useGlobalSearch.ts
│   └── useSearchDebounce.ts
├── api/
│   └── searchApi.ts
└── types/
    └── search.ts
```

---

## 2. 画面詳細設計

### 2.1 ヘッダー検索コンポーネント

#### 検索入力

| 画面項目 | 入力形式 | APIエンドポイント | リクエストフィールド | バリデーション |
|---------|---------|------------------|---------------------|---------------|
| 検索ボックス | テキスト入力 | GET /search | q | 2文字以上で検索実行 |
| ショートカットキー表示 | kbd要素 | - | - | Ctrl+K / Cmd+K |
| クリアボタン | アイコンボタン | - | - | 入力クリア |

#### 検索結果ドロップダウン

| 画面項目 | 表示形式 | APIエンドポイント | レスポンスフィールド | 変換処理 |
|---------|---------|------------------|---------------------|---------|
| 検索結果件数 | テキスト | GET /search | total | "n件" 形式 |
| 結果アイテム（アイコン） | アイコン | GET /search | results[].type | type→絵文字マッピング |
| 結果アイテム（名前） | テキスト | GET /search | results[].highlightedText | HTMLとしてレンダリング |
| 結果アイテム（説明） | テキスト | GET /search | results[].description | 50文字で切り詰め |
| 結果アイテム（プロジェクト名） | テキスト | GET /search | results[].projectName | 親プロジェクト表示 |
| 結果アイテム（更新日時） | テキスト | GET /search | results[].updatedAt | 相対時間表示 |
| 空状態 | アイコン+テキスト | - | - | 検索結果なしメッセージ |
| キーボードヒント | kbd要素群 | - | - | ↑↓/Enter/Esc |

#### タイプアイコンマッピング

| type | アイコン | 説明 |
|------|---------|------|
| project | 📁 | プロジェクト |
| session | 📊 | 分析セッション |
| file | 📄 | ファイル |
| tree | 🌳 | ドライバーツリー |

---

## 3. インタラクション設計

### 3.1 検索フロー

```text
1. Ctrl+K でフォーカス → 検索ボックスにフォーカス
2. 入力開始 → 300msデバウンス後にAPI呼び出し
3. 結果表示 → ドロップダウン表示、最初の項目を選択状態
4. ↑↓キー → 選択項目を移動
5. Enterキー → 選択項目のURLに遷移
6. Escキー → ドロップダウンを閉じる
7. 外部クリック → ドロップダウンを閉じる
```

### 3.2 キーボードショートカット

| キー | 動作 |
|------|------|
| Ctrl+K / Cmd+K | 検索ボックスにフォーカス |
| ↑ | 前の結果を選択 |
| ↓ | 次の結果を選択 |
| Enter | 選択中の結果に遷移 |
| Esc | ドロップダウンを閉じる |

---

## 4. API呼び出しタイミング

| トリガー | API呼び出し | 備考 |
|---------|------------|------|
| 入力変更 | GET /search | 300msデバウンス、2文字以上 |
| タイプフィルター変更 | GET /search | 即座に実行 |
| フォーカス時 | なし | キャッシュがあれば表示 |
