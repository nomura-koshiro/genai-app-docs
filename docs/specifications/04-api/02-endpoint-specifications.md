# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜æ›¸ï¼ˆEndpoint Specificationsï¼‰

## ğŸ“‹ æ–‡æ›¸ç®¡ç†æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ›¸å** | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜æ›¸ï¼ˆEndpoint Specificationsï¼‰ |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | 1.0.0 |
| **ä½œæˆæ—¥** | 2025-01-11 |
| **æœ€çµ‚æ›´æ–°æ—¥** | 2025-01-11 |
| **ä½œæˆè€…** | Claude Code |
| **ãƒ¬ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹** | åˆç‰ˆ |

---

## ğŸ“‘ ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [System API](#2-system-api)
3. [Users API](#3-users-api)
4. [Projects API](#4-projects-api)
5. [Project Members API](#5-project-members-api)
6. [Project Files API](#6-project-files-api)
7. [Analysis API](#7-analysis-api)
8. [Analysis Templates API](#8-analysis-templates-api)
9. [Driver Tree API](#9-driver-tree-api)
10. [ä»˜éŒ²](#10-ä»˜éŒ²)

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

æœ¬è¨­è¨ˆæ›¸ã¯ã€genai-app-docsï¼ˆcamp-backendï¼‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨RESTful APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è©³ç´°ä»•æ§˜ã‚’å®šç¾©ã—ã¾ã™ã€‚

### 1.2 ãƒ™ãƒ¼ã‚¹URL

| ç’°å¢ƒ | ãƒ™ãƒ¼ã‚¹URL |
|------|----------|
| **é–‹ç™ºç’°å¢ƒ** | `http://localhost:8000` |
| **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°** | `https://api-staging.example.com` |
| **æœ¬ç•ªç’°å¢ƒ** | `https://api.example.com` |

### 1.3 å…±é€šä»•æ§˜

#### 1.3.1 èªè¨¼

**æœ¬ç•ªç’°å¢ƒï¼ˆENVIRONMENT=productionï¼‰**:

```http
Authorization: Bearer <Azure_AD_Token>
```

**é–‹ç™ºç’°å¢ƒï¼ˆAUTH_MODE=developmentï¼‰**:

```http
X-Mock-User-ID: <user_id>
X-Mock-User-Email: user@example.com
X-Mock-User-Roles: ["system_admin"]
```

#### 1.3.2 å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼**:

| ãƒ˜ãƒƒãƒ€ãƒ¼ | å¿…é ˆ | èª¬æ˜ |
|---------|------|------|
| `Content-Type` | POST/PUT/PATCH | `application/json` |
| `Authorization` | èªè¨¼å¿…é ˆ | `Bearer <token>` |
| `Accept` | âŒ | `application/json`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼**:

| ãƒ˜ãƒƒãƒ€ãƒ¼ | å€¤ |
|---------|---|
| `Content-Type` | `application/json; charset=utf-8` |
| `X-Request-ID` | `<uuid>` |
| `X-RateLimit-Limit` | `100` |
| `X-RateLimit-Remaining` | `<remaining>` |

#### 1.3.3 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | ç”¨é€” |
|-----------|------|------|
| **200 OK** | æˆåŠŸ | GET, PATCHæˆåŠŸæ™‚ |
| **201 Created** | ä½œæˆæˆåŠŸ | POSTæˆåŠŸæ™‚ |
| **204 No Content** | æˆåŠŸï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã—ï¼‰ | DELETEæˆåŠŸæ™‚ |
| **400 Bad Request** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| **401 Unauthorized** | èªè¨¼ã‚¨ãƒ©ãƒ¼ | èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ä¸æ­£/æœŸé™åˆ‡ã‚Œ |
| **403 Forbidden** | æ¨©é™ã‚¨ãƒ©ãƒ¼ | æ¨©é™ä¸è¶³ |
| **404 Not Found** | ãƒªã‚½ãƒ¼ã‚¹æœªå­˜åœ¨ | IDãŒå­˜åœ¨ã—ãªã„ |
| **409 Conflict** | ç«¶åˆã‚¨ãƒ©ãƒ¼ | ä¸€æ„åˆ¶ç´„é•å |
| **422 Unprocessable Entity** | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•— |
| **429 Too Many Requests** | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é | 100req/minè¶…é |
| **500 Internal Server Error** | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ |

#### 1.3.4 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

```json
{
  "detail": {
    "error_code": "VALIDATION_ERROR",
    "message": "å…¥åŠ›å€¤ãŒä¸æ­£ã§ã™",
    "details": [
      {
        "field": "email",
        "message": "Invalid email format"
      }
    ]
  }
}
```

---

## 2. System API

ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”¨ã®å†…éƒ¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

### 2.1 Root

#### `GET /`

ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚APIã®åŸºæœ¬æƒ…å ±ã‚’è¿”ã—ã¾ã™ã€‚

**èªè¨¼**: ä¸è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "message": "Welcome to genai-app-docs API",
  "version": "0.1.0",
  "environment": "development",
  "docs_url": "/docs",
  "redoc_url": "/redoc"
}
```

---

### 2.2 Health Check

#### `GET /health`

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãã®ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®æ­£å¸¸æ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚

**èªè¨¼**: ä¸è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "status": "healthy",
  "timestamp": "2025-01-11T10:30:00.000000Z",
  "version": "0.1.0",
  "environment": "development",
  "services": {
    "database": "healthy",
    "redis": "healthy"
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `status` | string | ç·åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ`healthy` \| `degraded`ï¼‰ |
| `timestamp` | string | ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œæ™‚åˆ»ï¼ˆISO 8601, UTCï¼‰ |
| `version` | string | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
| `environment` | string | å®Ÿè¡Œç’°å¢ƒ |
| `services.database` | string | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ï¼ˆ`healthy` \| `unhealthy`ï¼‰ |
| `services.redis` | string | RedisçŠ¶æ…‹ï¼ˆ`healthy` \| `unhealthy` \| `disabled`ï¼‰ |

**ä½¿ç”¨ä¾‹**:

```bash
curl http://localhost:8000/health
```

---

### 2.3 Prometheus Metrics

#### `GET /metrics`

Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**èªè¨¼**: ä¸è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OKï¼ˆ`text/plain`ï¼‰

```text
# HELP http_requests_total HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆç·æ•°
# TYPE http_requests_total counter
http_requests_total{method="GET",endpoint="/api/v1/users",status_code="200"} 1523.0
http_requests_total{method="POST",endpoint="/api/v1/projects",status_code="201"} 842.0

# HELP http_request_duration_seconds HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ™‚é–“ï¼ˆç§’ï¼‰
# TYPE http_request_duration_seconds histogram
http_request_duration_seconds_bucket{method="GET",endpoint="/api/v1/users",le="0.1"} 1200.0
...
```

**ä½¿ç”¨ä¾‹**:

```bash
curl http://localhost:8000/metrics
```

---

## 3. Users API

ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚Azure ADèªè¨¼ã«å¯¾å¿œã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/users`

### 3.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—

#### `GET /api/v1/users`

ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆSystemAdminãƒ­ãƒ¼ãƒ«ï¼‰

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|---|------|-----------|------|
| `skip` | integer | âŒ | 0 | ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |
| `limit` | integer | âŒ | 100 | å–å¾—ã™ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ï¼ˆæœ€å¤§: 1000ï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "users": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "azure_oid": "azure-oid-12345",
      "email": "user@example.com",
      "display_name": "John Doe",
      "roles": ["user"],
      "is_active": true,
      "created_at": "2025-01-01T00:00:00Z",
      "updated_at": "2025-01-01T00:00:00Z",
      "last_login": "2025-01-11T10:30:00Z"
    }
  ],
  "total": 150,
  "skip": 0,
  "limit": 100
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **401 Unauthorized**: èªè¨¼ã•ã‚Œã¦ã„ãªã„
- **403 Forbidden**: SystemAdminãƒ­ãƒ¼ãƒ«ãŒãªã„

---

### 3.2 ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—

#### `GET /api/v1/users/me`

èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "azure_oid": "azure-oid-12345",
  "email": "user@example.com",
  "display_name": "John Doe",
  "roles": ["user"],
  "is_active": true,
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z",
  "last_login": "2025-01-11T10:30:00Z"
}
```

---

### 3.3 ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—

#### `GET /api/v1/users/{user_id}`

æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆSystemAdminãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `user_id` | UUID | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "azure_oid": "azure-oid-12345",
  "email": "user@example.com",
  "display_name": "John Doe",
  "roles": ["user"],
  "is_active": true,
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z",
  "last_login": "2025-01-11T10:30:00Z"
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **404 Not Found**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„

---

### 3.4 ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°

#### `PATCH /api/v1/users/me`

èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "display_name": "Jane Doe"
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `display_name` | string | âŒ | è¡¨ç¤ºåï¼ˆæœ€å¤§255æ–‡å­—ï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "azure_oid": "azure-oid-12345",
  "email": "user@example.com",
  "display_name": "Jane Doe",
  "roles": ["user"],
  "is_active": true,
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-11T11:00:00Z",
  "last_login": "2025-01-11T10:30:00Z"
}
```

---

### 3.5 ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤

#### `DELETE /api/v1/users/{user_id}`

æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆSystemAdminãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `user_id` | UUID | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 204 No Content

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **404 Not Found**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„
- **409 Conflict**: ProjectFileã®uploaded_byåˆ¶ç´„ã§RESTRICTï¼ˆå‰Šé™¤ä¸å¯ï¼‰

---

## 4. Projects API

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/projects`

### 4.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§å–å¾—

#### `GET /api/v1/projects`

èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰€å±ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|---|------|-----------|------|
| `skip` | integer | âŒ | 0 | ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |
| `limit` | integer | âŒ | 100 | å–å¾—ã™ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ï¼ˆæœ€å¤§: 1000ï¼‰ |
| `is_active` | boolean | âŒ | - | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ãƒ•ã‚£ãƒ«ã‚¿ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "650e8400-e29b-41d4-a716-446655440000",
    "name": "AI Development Project",
    "code": "AI-001",
    "description": "Project for AI model development",
    "is_active": true,
    "created_by": "550e8400-e29b-41d4-a716-446655440000",
    "created_at": "2025-01-01T00:00:00Z",
    "updated_at": "2025-01-01T00:00:00Z",
    "member_count": 5,
    "file_count": 12
  }
]
```

---

### 4.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

#### `POST /api/v1/projects`

æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä½œæˆè€…ã¯è‡ªå‹•çš„ã«PROJECT_MANAGERãƒ­ãƒ¼ãƒ«ã§è¿½åŠ ã•ã‚Œã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "name": "AI Development Project",
  "code": "AI-001",
  "description": "Project for AI model development"
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `name` | string | âœ… | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆæœ€å¤§255æ–‡å­—ï¼‰ |
| `code` | string | âœ… | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆæœ€å¤§50æ–‡å­—ã€ä¸€æ„ï¼‰ |
| `description` | string | âŒ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "650e8400-e29b-41d4-a716-446655440000",
  "name": "AI Development Project",
  "code": "AI-001",
  "description": "Project for AI model development",
  "is_active": true,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-11T12:00:00Z",
  "updated_at": "2025-01-11T12:00:00Z",
  "member_count": 1,
  "file_count": 0
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **409 Conflict**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ—¢ã«å­˜åœ¨

---

### 4.3 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°å–å¾—

#### `GET /api/v1/projects/{project_id}`

æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "650e8400-e29b-41d4-a716-446655440000",
  "name": "AI Development Project",
  "code": "AI-001",
  "description": "Project for AI model development",
  "is_active": true,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z",
  "member_count": 5,
  "file_count": 12
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã§ã¯ãªã„
- **404 Not Found**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„

---

### 4.4 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰æ¤œç´¢

#### `GET /api/v1/projects/code/{code}`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `code` | string | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "650e8400-e29b-41d4-a716-446655440000",
  "name": "AI Development Project",
  "code": "AI-001",
  "description": "Project for AI model development",
  "is_active": true,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z",
  "member_count": 5,
  "file_count": 12
}
```

---

### 4.5 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°

#### `PATCH /api/v1/projects/{project_id}`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆPROJECT_MANAGER or PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "name": "Updated AI Project",
  "description": "Updated description",
  "is_active": false
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `name` | string | âŒ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå |
| `description` | string | âŒ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜ |
| `is_active` | boolean | âŒ | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚° |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "650e8400-e29b-41d4-a716-446655440000",
  "name": "Updated AI Project",
  "code": "AI-001",
  "description": "Updated description",
  "is_active": false,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-11T13:00:00Z",
  "member_count": 5,
  "file_count": 12
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: PROJECT_MANAGER/PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ãŒãªã„

---

### 4.6 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤

#### `DELETE /api/v1/projects/{project_id}`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚é–¢é€£ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ï¼ˆCASCADEï¼‰ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆPROJECT_MANAGERãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 204 No Content

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: PROJECT_MANAGERãƒ­ãƒ¼ãƒ«ãŒãªã„
- **404 Not Found**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„

---

## 5. Project Members API

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/projects/{project_id}/members`

### 5.1 ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§å–å¾—

#### `GET /api/v1/projects/{project_id}/members`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "750e8400-e29b-41d4-a716-446655440000",
    "project_id": "650e8400-e29b-41d4-a716-446655440000",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "role": "project_manager",
    "joined_at": "2025-01-01T00:00:00Z",
    "added_by": null,
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "user@example.com",
      "display_name": "John Doe"
    }
  }
]
```

---

### 5.2 ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 

#### `POST /api/v1/projects/{project_id}/members`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆPROJECT_MANAGER or PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "user_id": "560e8400-e29b-41d4-a716-446655440000",
  "role": "member"
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `user_id` | UUID | âœ… | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| `role` | string | âœ… | ãƒ­ãƒ¼ãƒ«ï¼ˆ`project_manager` \| `project_moderator` \| `member` \| `viewer`ï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "760e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "user_id": "560e8400-e29b-41d4-a716-446655440000",
  "role": "member",
  "joined_at": "2025-01-11T14:00:00Z",
  "added_by": "550e8400-e29b-41d4-a716-446655440000",
  "user": {
    "id": "560e8400-e29b-41d4-a716-446655440000",
    "email": "newuser@example.com",
    "display_name": "New User"
  }
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: PROJECT_MANAGER/PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ãŒãªã„
- **404 Not Found**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„
- **409 Conflict**: æ—¢ã«ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦å­˜åœ¨

**ãƒ­ãƒ¼ãƒ«è¿½åŠ åˆ¶é™**:

- **PROJECT_MODERATOR**ã¯`project_manager`ãƒ­ãƒ¼ãƒ«ã‚’è¿½åŠ ã§ããªã„

---

### 5.3 ãƒ¡ãƒ³ãƒãƒ¼ãƒ­ãƒ¼ãƒ«æ›´æ–°

#### `PATCH /api/v1/projects/{project_id}/members/{member_id}`

ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆPROJECT_MANAGER or PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |
| `member_id` | UUID | ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "role": "project_moderator"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "760e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "user_id": "560e8400-e29b-41d4-a716-446655440000",
  "role": "project_moderator",
  "joined_at": "2025-01-11T14:00:00Z",
  "added_by": "550e8400-e29b-41d4-a716-446655440000",
  "user": {
    "id": "560e8400-e29b-41d4-a716-446655440000",
    "email": "newuser@example.com",
    "display_name": "New User"
  }
}
```

---

### 5.4 ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤

#### `DELETE /api/v1/projects/{project_id}/members/{member_id}`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆPROJECT_MANAGER or PROJECT_MODERATORãƒ­ãƒ¼ãƒ«ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |
| `member_id` | UUID | ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 204 No Content

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: æ¨©é™ãŒãªã„ã€ã¾ãŸã¯æœ€å¾Œã®PROJECT_MANAGERã‚’å‰Šé™¤ã—ã‚ˆã†ã¨ã—ãŸ

---

## 6. Project Files API

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/projects/{project_id}/files`

### 6.1 ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—

#### `GET /api/v1/projects/{project_id}/files`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|---|------|-----------|------|
| `skip` | integer | âŒ | 0 | ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |
| `limit` | integer | âŒ | 100 | å–å¾—ã™ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "850e8400-e29b-41d4-a716-446655440000",
    "project_id": "650e8400-e29b-41d4-a716-446655440000",
    "filename": "data_2025.xlsx",
    "original_filename": "sales_data_2025.xlsx",
    "file_path": "projects/AI-001/data_2025.xlsx",
    "file_size": 1048576,
    "mime_type": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    "uploaded_by": "550e8400-e29b-41d4-a716-446655440000",
    "uploaded_at": "2025-01-11T15:00:00Z"
  }
]
```

---

### 6.2 ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### `POST /api/v1/projects/{project_id}/files`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆMEMBERä»¥ä¸Šï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: `multipart/form-data`

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `file` | file | âœ… | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ« |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "850e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "filename": "data_2025.xlsx",
  "original_filename": "sales_data_2025.xlsx",
  "file_path": "projects/AI-001/data_2025.xlsx",
  "file_size": 1048576,
  "mime_type": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
  "uploaded_by": "550e8400-e29b-41d4-a716-446655440000",
  "uploaded_at": "2025-01-11T15:00:00Z"
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: MEMBERä»¥ä¸Šã®ãƒ­ãƒ¼ãƒ«ãŒãªã„
- **413 Payload Too Large**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…éï¼ˆæœ€å¤§100MBï¼‰

---

### 6.3 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

#### `GET /api/v1/projects/{project_id}/files/{file_id}/download`

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |
| `file_id` | UUID | ãƒ•ã‚¡ã‚¤ãƒ«ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OKï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼‰

**ãƒ˜ãƒƒãƒ€ãƒ¼**:

```text
Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="sales_data_2025.xlsx"
```

---

### 6.4 ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

#### `DELETE /api/v1/projects/{project_id}/files/{file_id}`

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆMEMBERä»¥ä¸Šã€ã¾ãŸã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è€…æœ¬äººï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `project_id` | UUID | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |
| `file_id` | UUID | ãƒ•ã‚¡ã‚¤ãƒ«ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 204 No Content

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

- **403 Forbidden**: MEMBERä»¥ä¸Šã®ãƒ­ãƒ¼ãƒ«ãŒãªãã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è€…ã§ã‚‚ãªã„
- **404 Not Found**: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„

---

## 7. Analysis API

ãƒ‡ãƒ¼ã‚¿åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/analysis`

### 7.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾—

#### `GET /api/v1/analysis/sessions`

åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|---|------|-----------|------|
| `project_id` | UUID | âŒ | - | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã§ãƒ•ã‚£ãƒ«ã‚¿ |
| `skip` | integer | âŒ | 0 | ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |
| `limit` | integer | âŒ | 100 | å–å¾—ã™ã‚‹æœ€å¤§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "950e8400-e29b-41d4-a716-446655440000",
    "project_id": "650e8400-e29b-41d4-a716-446655440000",
    "session_name": "Q1 Sales Analysis",
    "validation_config": {
      "policy": "å¸‚å ´æ‹¡å¤§",
      "issue": "æ–°è¦å‚å…¥"
    },
    "chat_history": [],
    "snapshot_history": null,
    "original_file_id": null,
    "is_active": true,
    "created_by": "550e8400-e29b-41d4-a716-446655440000",
    "created_at": "2025-01-11T16:00:00Z",
    "updated_at": "2025-01-11T16:00:00Z"
  }
]
```

---

### 7.2 ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ

#### `POST /api/v1/analysis/sessions`

æ–°ã—ã„åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "session_name": "Q1 Sales Analysis",
  "validation_config": {
    "policy": "å¸‚å ´æ‹¡å¤§",
    "issue": "æ–°è¦å‚å…¥"
  }
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `project_id` | UUID | âœ… | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID |
| `session_name` | string | âŒ | ã‚»ãƒƒã‚·ãƒ§ãƒ³å |
| `validation_config` | object | âœ… | åˆ†æè¨­å®šï¼ˆvalidation.ymlï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "950e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "session_name": "Q1 Sales Analysis",
  "validation_config": {
    "policy": "å¸‚å ´æ‹¡å¤§",
    "issue": "æ–°è¦å‚å…¥"
  },
  "chat_history": [],
  "snapshot_history": null,
  "original_file_id": null,
  "is_active": true,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-11T16:00:00Z",
  "updated_at": "2025-01-11T16:00:00Z"
}
```

---

### 7.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³è©³ç´°å–å¾—

#### `GET /api/v1/analysis/sessions/{session_id}`

åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©³ç´°ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `session_id` | UUID | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "id": "950e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440000",
  "session_name": "Q1 Sales Analysis",
  "validation_config": {
    "policy": "å¸‚å ´æ‹¡å¤§",
    "issue": "æ–°è¦å‚å…¥"
  },
  "chat_history": [
    {
      "role": "user",
      "content": "å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ãã ã•ã„",
      "timestamp": "2025-01-11T16:05:00Z"
    },
    {
      "role": "assistant",
      "content": "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã¾ãšã€ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™ã€‚",
      "timestamp": "2025-01-11T16:05:02Z"
    }
  ],
  "snapshot_history": null,
  "original_file_id": "850e8400-e29b-41d4-a716-446655440000",
  "is_active": true,
  "created_by": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-11T16:00:00Z",
  "updated_at": "2025-01-11T16:05:02Z"
}
```

---

### 7.4 ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

#### `POST /api/v1/analysis/sessions/{session_id}/chat`

åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `session_id` | UUID | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "message": "å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åœ°åŸŸåˆ¥ã«é›†è¨ˆã—ã¦ãã ã•ã„"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
{
  "role": "assistant",
  "content": "åœ°åŸŸåˆ¥å£²ä¸Šã‚’é›†è¨ˆã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®çµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚...",
  "timestamp": "2025-01-11T16:10:00Z"
}
```

---

## 8. Analysis Templates API

åˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/analysis-templates`

### 8.1 ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§å–å¾—

#### `GET /api/v1/analysis-templates`

åˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "a50e8400-e29b-41d4-a716-446655440000",
    "template_name": "å£²ä¸Šåˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
    "description": "å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–çš„ãªåˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
    "settings": {
      "default_charts": ["bar", "line"],
      "default_filters": ["date", "region"]
    },
    "created_at": "2025-01-01T00:00:00Z",
    "updated_at": "2025-01-01T00:00:00Z"
  }
]
```

---

## 9. Driver Tree API

ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ„ãƒªãƒ¼ï¼ˆKPIåˆ†è§£ãƒ„ãƒªãƒ¼ï¼‰ç®¡ç†APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€‚

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/api/v1/driver-trees`

### 9.1 ãƒ„ãƒªãƒ¼ä¸€è¦§å–å¾—

#### `GET /api/v1/driver-trees`

ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ„ãƒªãƒ¼ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 200 OK

```json
[
  {
    "id": "b50e8400-e29b-41d4-a716-446655440000",
    "name": "ç²—åˆ©åˆ†æ",
    "root_node_id": "c50e8400-e29b-41d4-a716-446655440000",
    "created_at": "2025-01-01T00:00:00Z",
    "updated_at": "2025-01-01T00:00:00Z"
  }
]
```

---

### 9.2 ãƒ„ãƒªãƒ¼ä½œæˆ

#### `POST /api/v1/driver-trees`

æ–°ã—ã„ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ„ãƒªãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "name": "ç²—åˆ©åˆ†æ",
  "root_label": "ç²—åˆ©"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "b50e8400-e29b-41d4-a716-446655440000",
  "name": "ç²—åˆ©åˆ†æ",
  "root_node_id": "c50e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-11T17:00:00Z",
  "updated_at": "2025-01-11T17:00:00Z"
}
```

---

### 9.3 ãƒãƒ¼ãƒ‰è¿½åŠ 

#### `POST /api/v1/driver-trees/{tree_id}/nodes`

ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ„ãƒªãƒ¼ã«ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

**èªè¨¼**: âœ… å¿…é ˆ

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `tree_id` | UUID | ãƒ„ãƒªãƒ¼ID |

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:

```json
{
  "parent_id": "c50e8400-e29b-41d4-a716-446655440000",
  "label": "å£²ä¸Š",
  "operator": "-"
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|---|------|------|
| `parent_id` | UUID | âœ… | è¦ªãƒãƒ¼ãƒ‰ID |
| `label` | string | âœ… | ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ« |
| `operator` | string | âŒ | æ¼”ç®—å­ï¼ˆ`+`, `-`, `*`, `/`ï¼‰ |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: 201 Created

```json
{
  "id": "d50e8400-e29b-41d4-a716-446655440000",
  "tree_id": "b50e8400-e29b-41d4-a716-446655440000",
  "parent_id": "c50e8400-e29b-41d4-a716-446655440000",
  "label": "å£²ä¸Š",
  "operator": "-",
  "node_data": {},
  "created_at": "2025-01-11T17:05:00Z",
  "updated_at": "2025-01-11T17:05:00Z"
}
```

---

## 10. ä»˜éŒ²

### 10.1 èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ä¾‹

#### Azure AD Tokenï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

```http
POST /api/v1/projects
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6...
Content-Type: application/json

{
  "name": "New Project",
  "code": "PROJ-001"
}
```

#### ãƒ¢ãƒƒã‚¯èªè¨¼ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰

```http
POST /api/v1/projects
X-Mock-User-ID: 550e8400-e29b-41d4-a716-446655440000
X-Mock-User-Email: user@example.com
X-Mock-User-Roles: ["user"]
Content-Type: application/json

{
  "name": "New Project",
  "code": "PROJ-001"
}
```

### 10.2 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµ±è¨ˆ

| ã‚«ãƒ†ã‚´ãƒª | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•° |
|---------|---------------|
| System API | 3 |
| Users API | 5 |
| Projects API | 6 |
| Project Members API | 4 |
| Project Files API | 4 |
| Analysis API | 4 |
| Analysis Templates API | 1 |
| Driver Tree API | 3 |
| **åˆè¨ˆ** | **30+** |

### 10.3 ãƒ¬ãƒ¼ãƒˆåˆ¶é™

**åˆ¶é™**: 100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†/IPã‚¢ãƒ‰ãƒ¬ã‚¹

**ãƒ˜ãƒƒãƒ€ãƒ¼**:

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 85
X-RateLimit-Reset: 1673437200
```

**ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…éæ™‚**:

```http
HTTP/1.1 429 Too Many Requests
Retry-After: 60

{
  "detail": {
    "error_code": "RATE_LIMIT_EXCEEDED",
    "message": "Rate limit exceeded. Please try again later.",
    "retry_after": 60
  }
}
```

### 10.4 Swagger UI / ReDoc

**Swagger UI**: `http://localhost:8000/docs`

**ReDoc**: `http://localhost:8000/redoc`

### 10.5 é–¢é€£è¨­è¨ˆæ›¸

| è¨­è¨ˆæ›¸ | é–¢é€£ç®‡æ‰€ |
|-------|---------|
| [APIè¨­è¨ˆæ›¸](./01-api-design.md) | APIå…¨ä½“è¨­è¨ˆã€ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |
| [Response Schemas](./03-response-schemas.md) | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚­ãƒ¼ãƒè©³ç´° |
| [RBACè¨­è¨ˆæ›¸](../03-security/01-rbac-design.md) | ãƒ­ãƒ¼ãƒ«ã¨æ¨©é™ |
| [Authenticationè¨­è¨ˆæ›¸](../03-security/02-authentication-design.md) | èªè¨¼æ–¹å¼ |

### 10.6 ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| **UUID** | Universally Unique Identifierï¼ˆ128ãƒ“ãƒƒãƒˆè­˜åˆ¥å­ï¼‰ |
| **Bearer Token** | OAuth 2.0ã§ä½¿ç”¨ã•ã‚Œã‚‹èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ |
| **RBAC** | Role-Based Access Controlï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰ |
| **Pagination** | ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åˆ†å‰²å–å¾—ï¼‰ |
| **Rate Limiting** | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆAPIå‘¼ã³å‡ºã—é »åº¦ã®åˆ¶é™ï¼‰ |

### 10.7 å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | å¤‰æ›´è€… |
|-----------|------|---------|--------|
| 1.0.0 | 2025-01-11 | åˆç‰ˆä½œæˆ | Claude Code |

---

ã“ã®Endpoint Specificationsè¨­è¨ˆæ›¸ã¯ã€genai-app-docsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è©³ç´°ä»•æ§˜ã‚’æä¾›ã—ã¾ã™ã€‚
OpenAPI 3.0ã«æº–æ‹ ã—ãŸå½¢å¼ã§ã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€èªè¨¼ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Œå…¨ã«æ–‡æ›¸åŒ–ã—ã¦ã„ã¾ã™ã€‚
