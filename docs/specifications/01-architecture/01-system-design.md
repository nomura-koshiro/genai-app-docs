# ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ï¼ˆSystem Designï¼‰

## ğŸ“‹ æ–‡æ›¸ç®¡ç†æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ›¸å** | ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ï¼ˆSystem Designï¼‰ |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | 1.0.0 |
| **ä½œæˆæ—¥** | 2025-01-11 |
| **æœ€çµ‚æ›´æ–°æ—¥** | 2025-01-11 |
| **ä½œæˆè€…** | Claude Code |
| **ãƒ¬ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹** | åˆç‰ˆ |

---

## ğŸ“‘ ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ](#2-ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#4-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
5. [ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#5-ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
6. [ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰](#6-ä¾å­˜æ€§æ³¨å…¥di)
7. [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³](#7-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³)
8. [è¨­å®šç®¡ç†](#8-è¨­å®šç®¡ç†)
9. [ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†](#9-ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†)
10. [ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³](#10-ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#11-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
12. [ä»˜éŒ²](#12-ä»˜éŒ²)

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

æœ¬è¨­è¨ˆæ›¸ã¯ã€genai-app-docsï¼ˆcamp-backendï¼‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è¨­è¨ˆåˆ¤æ–­ã‚’æ–‡æ›¸åŒ–ã—ã€ä»¥ä¸‹ã‚’é”æˆã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ï¼š

- **ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç†è§£ä¿ƒé€²**: æ–°è¦å‚ç”»è€…ãŒè¿…é€Ÿã«ã‚·ã‚¹ãƒ†ãƒ ã‚’ç†è§£ã§ãã‚‹
- **è¨­è¨ˆåˆ¤æ–­ã®è¨˜éŒ²**: ãªãœã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’é¸æŠã—ãŸã®ã‹ã‚’èª¬æ˜
- **ä¿å®ˆæ€§ã®å‘ä¸Š**: ä¸€è²«ã—ãŸè¨­è¨ˆåŸå‰‡ã«åŸºã¥ãé–‹ç™ºã‚’æ”¯æ´
- **æŠ€è¡“çš„è² å‚µã®å‰Šæ¸›**: è¨­è¨ˆæ„å›³ã‚’æ˜ç¢ºã«ã—ã€èª¤ã£ãŸå®Ÿè£…ã‚’é˜²æ­¢

### 1.2 é©ç”¨ç¯„å›²

æœ¬è¨­è¨ˆæ›¸ã¯ä»¥ä¸‹ã‚’å¯¾è±¡ã¨ã—ã¾ã™ï¼š

- âœ… ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ
- âœ… æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨é¸å®šç†ç”±
- âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
- âœ… ä¾å­˜æ€§æ³¨å…¥ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
- âœ… è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

ä»¥ä¸‹ã¯**å¯¾è±¡å¤–**ã¨ã—ã€åˆ¥ã®è¨­è¨ˆæ›¸ã§è©³è¿°ã—ã¾ã™ï¼š

- âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®è©³ç´° â†’ [Databaseè¨­è¨ˆæ›¸](../02-database/01-database-design.md)
- âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼ã®è©³ç´° â†’ [RBACè¨­è¨ˆæ›¸](../03-security/01-rbac-design.md)
- âŒ APIä»•æ§˜ã®è©³ç´° â†’ [APIè¨­è¨ˆæ›¸](../04-api/01-api-design.md)

### 1.3 å‰ææ¡ä»¶

æœ¬è¨­è¨ˆæ›¸ã‚’èª­ã‚€ã«ã¯ä»¥ä¸‹ã®çŸ¥è­˜ãŒæ¨å¥¨ã•ã‚Œã¾ã™ï¼š

- **Python 3.13+**: éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ˆasync/awaitï¼‰
- **FastAPI**: åŸºæœ¬çš„ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
- **SQLAlchemy 2.0**: ORMåŸºç¤
- **PostgreSQL**: ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç¤
- **REST API**: åŸºæœ¬çš„ãªHTTPãƒ¡ã‚½ãƒƒãƒ‰ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

---

## 2. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ

### 2.1 ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

**genai-app-docsï¼ˆcamp-backendï¼‰** ã¯ã€FastAPI + LangChain + LangGraphã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ©Ÿèƒ½ã¨ãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½ã‚’æŒã¤ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½**:

- ğŸ¤– **AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**: LangGraphã«ã‚ˆã‚‹é«˜åº¦ãªä¼šè©±ã‚¨ãƒ³ã‚¸ãƒ³
- ğŸ“Š **ãƒ‡ãƒ¼ã‚¿åˆ†æ**: pandasé€£æºã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿é›†è¨ˆãƒ»ã‚°ãƒ©ãƒ•ç”Ÿæˆ
- ğŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- ğŸ” **èªè¨¼ãƒ»èªå¯**: Azure AD / JWTèªè¨¼ã€RBACï¼ˆ2éšå±¤ãƒ­ãƒ¼ãƒ«ï¼‰
- ğŸš€ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†**: ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹

### 2.2 ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå›³

```mermaid
graph TB
    subgraph "External Users"
        WebUI[ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UI<br/>React/Next.js]
        SwaggerUI[Swagger UI<br/>APIé–‹ç™ºè€…]
    end

    subgraph "genai-app-docs Backend"
        API[FastAPI<br/>Application]

        subgraph "Core Services"
            AuthSvc[èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹]
            ProjectSvc[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ¼ãƒ“ã‚¹]
            AnalysisSvc[åˆ†æã‚µãƒ¼ãƒ“ã‚¹]
            FileSvc[ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ“ã‚¹]
        end

        subgraph "AI/Agent Layer"
            LangGraph[LangGraph<br/>Agent Executor]
            LangChain[LangChain<br/>Tools & Chains]
        end
    end

    subgraph "External Systems"
        AzureAD[Azure AD<br/>èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼]
        AnthropicAPI[Anthropic API<br/>Claude LLM]
        OpenAIAPI[OpenAI API<br/>GPT LLM]
    end

    subgraph "Data Storage"
        PostgreSQL[(PostgreSQL<br/>ãƒ¡ã‚¤ãƒ³DB)]
        Redis[(Redis<br/>ã‚­ãƒ£ãƒƒã‚·ãƒ¥)]
        AzureBlob[Azure Blob Storage<br/>ãƒ•ã‚¡ã‚¤ãƒ«]
        LocalFS[Local File System<br/>é–‹ç™ºç”¨)]
    end

    WebUI -->|REST API| API
    SwaggerUI -->|REST API| API

    API --> AuthSvc
    API --> ProjectSvc
    API --> AnalysisSvc
    API --> FileSvc

    AnalysisSvc --> LangGraph
    LangGraph --> LangChain

    AuthSvc -.->|Azure AD<br/>Tokenæ¤œè¨¼| AzureAD
    LangChain -.->|LLM API| AnthropicAPI
    LangChain -.->|LLM API| OpenAIAPI

    API --> PostgreSQL
    API --> Redis
    FileSvc --> AzureBlob
    FileSvc --> LocalFS
```

### 2.3 ã‚·ã‚¹ãƒ†ãƒ ç‰¹æ€§

| ç‰¹æ€§ | ç¾çŠ¶ã®è¨­è¨ˆ | ç›®æ¨™ |
|------|-----------|------|
| **å¯ç”¨æ€§** | å˜ä¸€ã‚µãƒ¼ãƒãƒ¼ | 99.9% (ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ + å†—é•·åŒ–) |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | 100req/minåˆ¶é™ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  < 200ms (95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«) |
| **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£** | å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° | æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹è¨­è¨ˆï¼‰ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | Azure ADèªè¨¼, RBAC | OWASP Top 10å¯¾ç­–ã€ç›£æŸ»ãƒ­ã‚° |
| **ä¿å®ˆæ€§** | 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ > 80% |

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 3.1 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“å›³

```mermaid
graph TB
    subgraph "Application Layer"
        FastAPI[FastAPI 0.115+<br/>Web Framework]
        Uvicorn[Uvicorn<br/>ASGI Server]
        Pydantic[Pydantic 2.0+<br/>Validation]
    end

    subgraph "AI/Agent Layer"
        LangChain[LangChain 0.3+<br/>LLM Framework]
        LangGraph[LangGraph 0.2+<br/>Agent Orchestration]
        LangServe[LangServe 0.3+<br/>Deployment]
        LangSmith[LangSmith<br/>Observability]
    end

    subgraph "Data Layer"
        SQLAlchemy[SQLAlchemy 2.0+<br/>ORM]
        Alembic[Alembic<br/>Migration]
        AsyncPG[asyncpg<br/>PostgreSQL Driver]
        Psycopg2[psycopg2-binary<br/>Sync Driver]
    end

    subgraph "Storage Layer"
        AzureStorage[azure-storage-blob<br/>Blob Storage]
        AzureIdentity[azure-identity<br/>Auth]
        AIOFiles[aiofiles<br/>Async File IO]
    end

    subgraph "Processing Layer"
        Pandas[pandas<br/>Data Analysis]
        PythonPPTX[python-pptx<br/>PowerPoint]
    end

    subgraph "Security Layer"
        Passlib[passlib[bcrypt]<br/>Password Hashing]
        PythonJose[python-jose<br/>JWT]
        FastAPIAzure[fastapi-azure-auth<br/>Azure AD]
    end

    subgraph "Infrastructure Layer"
        Redis[redis[hiredis]<br/>Cache]
        Prometheus[prometheus-client<br/>Metrics]
        Structlog[structlog<br/>Logging]
        HTTPX[httpx<br/>HTTP Client]
    end

    FastAPI --> Pydantic
    FastAPI --> SQLAlchemy
    FastAPI --> LangChain
    LangChain --> LangGraph
    LangGraph --> LangSmith
    SQLAlchemy --> AsyncPG
    SQLAlchemy --> Alembic
```

### 3.2 ä¸»è¦æŠ€è¡“ã®é¸å®šç†ç”±

#### 3.2.1 Web Framework: FastAPI

**é¸å®šç†ç”±**:

- âœ… **é«˜é€Ÿ**: Uvicornï¼ˆASGIï¼‰ãƒ™ãƒ¼ã‚¹ã§éåŒæœŸå‡¦ç†ã«æœ€é©
- âœ… **è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ**: OpenAPI/Swagger UIè‡ªå‹•ç”Ÿæˆ
- âœ… **å‹å®‰å…¨æ€§**: Pydanticã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **ä¾å­˜æ€§æ³¨å…¥**: çµ„ã¿è¾¼ã¿DIã‚·ã‚¹ãƒ†ãƒ ï¼ˆDependsï¼‰
- âœ… **éåŒæœŸå¯¾å¿œ**: async/awaitãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ**:

| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | FastAPI | Flask | Django REST |
|--------------|---------|-------|-------------|
| éåŒæœŸã‚µãƒãƒ¼ãƒˆ | â— Native | â–³ å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | â–³ Django 3.1+ |
| è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | â— çµ„ã¿è¾¼ã¿ | âœ• æ‰‹å‹• | â–³ drf-spectacular |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | â— é«˜é€Ÿ | â—‹ ä¸­é€Ÿ | â–³ ä½é€Ÿ |
| å­¦ç¿’æ›²ç·š | â—‹ ä¸­ | â— æ˜“ | â–³ é›£ |

#### 3.2.2 ORM: SQLAlchemy 2.0

**é¸å®šç†ç”±**:

- âœ… **éåŒæœŸå¯¾å¿œ**: asyncpgãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§å®Œå…¨éåŒæœŸ
- âœ… **å‹å®‰å…¨æ€§**: SQLAlchemy 2.0ã®Mappedå‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **å¼·åŠ›ãªã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€**: è¤‡é›‘ãªJOINã€ã‚µãƒ–ã‚¯ã‚¨ãƒªå¯¾å¿œ
- âœ… **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: Alembicã¨ã®çµ±åˆ
- âœ… **æˆç†Ÿåº¦**: 15å¹´ä»¥ä¸Šã®å®Ÿç¸¾

#### 3.2.3 AI/Agent: LangChain + LangGraph

**é¸å®šç†ç”±**:

- âœ… **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹ç¯‰**: LangGraphã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†å‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- âœ… **ãƒãƒ«ãƒLLMå¯¾å¿œ**: Anthropic, OpenAI, Azure OpenAIã‚’çµ±ä¸€API
- âœ… **ãƒ„ãƒ¼ãƒ«çµ±åˆ**: pandas, ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãªã©ã®ãƒ„ãƒ¼ãƒ«é€£æº
- âœ… **å¯è¦³æ¸¬æ€§**: LangSmithã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- âœ… **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**: æ´»ç™ºãªé–‹ç™ºã¨ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 

#### 3.2.4 Database: PostgreSQL

**é¸å®šç†ç”±**:

- âœ… **JSONBå‹**: æŸ”è»Ÿãªã‚¹ã‚­ãƒ¼ãƒï¼ˆanalysis_session.configï¼‰
- âœ… **UUIDå‹**: ãƒã‚¤ãƒ†ã‚£ãƒ–UUID v4ã‚µãƒãƒ¼ãƒˆ
- âœ… **ACIDä¿è¨¼**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ•´åˆæ€§
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°
- âœ… **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå¯¾å¿œ**: ç›£æŸ»ãƒ­ã‚°ã€ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### 3.3 ä¾å­˜é–¢ä¿‚ï¼ˆpyproject.tomlï¼‰

```toml
[project]
name = "camp-backend"
version = "0.1.0"
requires-python = ">=3.13"
dependencies = [
    # Web Framework
    "fastapi>=0.115.0",
    "uvicorn[standard]>=0.32.0",

    # AI/LangChain
    "langchain>=0.3.0",
    "langgraph>=0.2.0",
    "langserve>=0.3.0",
    "langsmith>=0.2.0",
    "langchain-anthropic>=0.3.0",
    "langchain-openai>=0.2.0",
    "langchain-community>=0.3.0",

    # Database
    "sqlalchemy>=2.0.0",
    "alembic>=1.13.0",
    "psycopg2-binary>=2.9.0",
    "asyncpg>=0.30.0",

    # File Processing
    "python-multipart>=0.0.17",
    "aiofiles>=24.1.0",
    "azure-storage-blob>=12.23.0",
    "azure-identity>=1.19.0",

    # Data Processing
    "pandas>=2.2.0",
    "python-pptx>=1.0.0",

    # Configuration & Utilities
    "pydantic-settings>=2.6.0",
    "pydantic[email]>=2.0.0",
    "python-dotenv>=1.0.0",

    # Logging
    "structlog>=24.4.0",

    # HTTP Client
    "httpx>=0.28.1",

    # Security
    "passlib[bcrypt]>=1.7.4",
    "python-jose[cryptography]>=3.3.0",

    # Cache
    "redis[hiredis]>=6.4.0",

    # Monitoring
    "prometheus-client>=0.23.1",
    "prometheus-fastapi-instrumentator>=7.1.0",
]
```

---

## 4. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 4.1 è¨­è¨ˆåŸå‰‡

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®è¨­è¨ˆåŸå‰‡ã«åŸºã¥ã„ã¦æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ï¼š

#### 4.1.1 SOLIDåŸå‰‡

1. **å˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼ˆSRP: Single Responsibility Principleï¼‰**
   - å„ã‚¯ãƒ©ã‚¹ã¯1ã¤ã®è²¬ä»»ã®ã¿ã‚’æŒã¤
   - ä¾‹: `ProjectMemberAuthorizationChecker` ã¯æ¨©é™ãƒã‚§ãƒƒã‚¯ã®ã¿ã‚’æ‹…å½“

2. **ã‚ªãƒ¼ãƒ—ãƒ³ãƒ»ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã®åŸå‰‡ï¼ˆOCP: Open/Closed Principleï¼‰**
   - æ‹¡å¼µã«å¯¾ã—ã¦é–‹ã„ã¦ã„ã‚‹ã€ä¿®æ­£ã«å¯¾ã—ã¦é–‰ã˜ã¦ã„ã‚‹
   - ä¾‹: `BaseRepository[ModelType, IDType]` ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹ã§æ‹¡å¼µå¯èƒ½

3. **ãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡ï¼ˆLSP: Liskov Substitution Principleï¼‰**
   - æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã¯åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ç½®æ›å¯èƒ½
   - ä¾‹: ã™ã¹ã¦ã®Repositoryã¯ `BaseRepository` ã¨äº’æ›æ€§ã‚ã‚Š

4. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢ã®åŸå‰‡ï¼ˆISP: Interface Segregation Principleï¼‰**
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ä½¿ç”¨ã—ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã«ä¾å­˜ã—ãªã„
   - ä¾‹: Facadeãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¿…è¦ãªæ“ä½œã®ã¿å…¬é–‹

5. **ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼ˆDIP: Dependency Inversion Principleï¼‰**
   - ä¸Šä½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä¸‹ä½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ä¾å­˜ã—ãªã„ã€æŠ½è±¡ã«ä¾å­˜ã™ã‚‹
   - ä¾‹: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¯Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæŠ½è±¡ï¼‰ã«ä¾å­˜

#### 4.1.2 Clean ArchitectureåŸå‰‡

```mermaid
graph TB
    subgraph "Outer Layer"
        API[API Layer<br/>routes/]
    end

    subgraph "Application Layer"
        Service[Service Layer<br/>services/]
    end

    subgraph "Domain Layer"
        Repository[Repository Layer<br/>repositories/]
    end

    subgraph "Infrastructure Layer"
        Model[Data Layer<br/>models/]
        DB[(Database)]
    end

    API -->|"ä¾å­˜"| Service
    Service -->|"ä¾å­˜"| Repository
    Repository -->|"ä¾å­˜"| Model
    Model --> DB

    style API fill:#e3f2fd
    style Service fill:#fff9c4
    style Repository fill:#c8e6c9
    style Model fill:#ffccbc
```

**ä¾å­˜æ€§ã®æ–¹å‘**: å¤–å´ã®å±¤ãŒå†…å´ã®å±¤ã«ä¾å­˜ã™ã‚‹ï¼ˆå˜ä¸€æ–¹å‘ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼‰

#### 4.1.3 DRYåŸå‰‡ï¼ˆDon't Repeat Yourselfï¼‰

- **BaseRepository**: ã™ã¹ã¦ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…±é€šã®CRUDæ“ä½œã‚’ä¸€å…ƒåŒ–
- **TimestampMixin**: created_at, updated_atãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…±é€šåŒ–
- **PrimaryKeyMixin**: UUIDä¸»ã‚­ãƒ¼ã‚’å…±é€šåŒ–

### 4.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›³

```mermaid
graph TB
    subgraph "API Layer (routes/)"
        SystemRoutes[System Routes<br/>health, metrics, root]
        V1Routes[V1 Routes<br/>users, projects, analysis]
        Middlewares[Middlewares<br/>CORS, Rate Limit, Logging]
        ExceptionHandlers[Exception Handlers<br/>ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–å‡¦ç†]
        Dependencies[Dependencies<br/>DIå®šç¾©]
    end

    subgraph "Service Layer (services/)"
        UserService[UserService<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†]
        ProjectService[ProjectService<br/>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†]
        MemberFacade[ProjectMemberFacade<br/>ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†]
        AnalysisService[AnalysisService<br/>ãƒ‡ãƒ¼ã‚¿åˆ†æ]
        FileService[FileService<br/>ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†]
        AuthChecker[AuthorizationChecker<br/>æ¨©é™ãƒã‚§ãƒƒã‚¯]
    end

    subgraph "Repository Layer (repositories/)"
        BaseRepo[BaseRepository<br/>å…±é€šCRUD]
        UserRepo[UserRepository]
        ProjectRepo[ProjectRepository]
        MemberRepo[MemberRepository]
        FileRepo[FileRepository]
    end

    subgraph "Data Layer (models/)"
        BaseModel[Base<br/>DeclarativeBase]
        Mixins[Mixins<br/>Timestamp, PrimaryKey]
        UserModel[User Model]
        ProjectModel[Project Model]
        MemberModel[ProjectMember Model]
    end

    subgraph "Core (core/)"
        Config[Config<br/>settingsç®¡ç†]
        Database[Database<br/>æ¥ç¶šç®¡ç†]
        Security[Security<br/>èªè¨¼ãƒ»èªå¯]
        Logging[Logging<br/>structlog]
        Cache[Cache<br/>Redisç®¡ç†]
    end

    V1Routes --> Dependencies
    Dependencies --> UserService
    Dependencies --> ProjectService
    Dependencies --> AnalysisService

    UserService --> UserRepo
    ProjectService --> ProjectRepo
    MemberFacade --> MemberRepo
    MemberFacade --> AuthChecker

    UserRepo --> BaseRepo
    ProjectRepo --> BaseRepo
    MemberRepo --> BaseRepo

    BaseRepo --> Database
    UserModel --> BaseModel
    UserModel --> Mixins

    style API Layer fill:#e3f2fd
    style Service Layer fill:#fff9c4
    style Repository Layer fill:#c8e6c9
    style Data Layer fill:#ffccbc
    style Core fill:#f3e5f5
```

---

## 5. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 5.1 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®4å±¤ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Layer (routes/)                                      â”‚
â”‚ - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡                                      â”‚
â”‚ - Pydanticã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                            â”‚
â”‚ - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ•´å½¢                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Layer (services/)                                â”‚
â”‚ - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                                        â”‚
â”‚ - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†                                    â”‚
â”‚ - è¤‡æ•°ãƒªãƒã‚¸ãƒˆãƒªã®èª¿æ•´                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Repository Layer (repositories/)                         â”‚
â”‚ - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯                                  â”‚
â”‚ - ã‚¯ã‚¨ãƒªæ§‹ç¯‰                                              â”‚
â”‚ - CRUDæ“ä½œ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Layer (models/)                                     â”‚
â”‚ - SQLAlchemyãƒ¢ãƒ‡ãƒ«å®šç¾©                                    â”‚
â”‚ - ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—å®šç¾©                                  â”‚
â”‚ - åˆ¶ç´„å®šç¾©                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 API Layerï¼ˆroutes/ï¼‰

**è²¬ä»»**:

- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä¿¡ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”å´
- Pydanticã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹å–å¾—
- èªè¨¼ãƒ»èªå¯ã®é©ç”¨

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **:

```text
api/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ dependencies.py      # DIå®šç¾©
â”‚   â””â”€â”€ exception_handlers.py # ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”œâ”€â”€ decorators/              # ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ï¼ˆèªå¯ã€å†è©¦è¡Œãªã©ï¼‰
â”œâ”€â”€ middlewares/             # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆCORS, Rate Limit, Loggingï¼‰
â””â”€â”€ routes/
    â”œâ”€â”€ system/              # ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆhealth, metricsï¼‰
    â”‚   â”œâ”€â”€ health.py
    â”‚   â”œâ”€â”€ metrics.py
    â”‚   â””â”€â”€ root.py
    â””â”€â”€ v1/                  # API v1ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        â”œâ”€â”€ users.py
        â”œâ”€â”€ projects.py
        â”œâ”€â”€ project_members.py
        â”œâ”€â”€ project_files.py
        â”œâ”€â”€ analysis.py
        â”œâ”€â”€ analysis_templates.py
        â”œâ”€â”€ ppt_generator.py
        â””â”€â”€ driver_tree.py
```

**å®Ÿè£…ä¾‹ï¼ˆ`routes/v1/users.py`ï¼‰**:

```python
from fastapi import APIRouter, Depends
from app.api.core.dependencies import AzureUserServiceDep, CurrentUserAzureDep
from app.schemas.user import UserResponse

router = APIRouter()

@router.get("/me", response_model=UserResponse)
async def get_current_user(
    current_user: CurrentUserAzureDep,
) -> UserResponse:
    """ç¾åœ¨ã®èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚"""
    return UserResponse.model_validate(current_user)
```

**è¨­è¨ˆæŒ‡é‡**:

- âœ… ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯è–„ãä¿ã¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã¾ãªã„ï¼‰
- âœ… ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¸ã®å§”è­²ã®ã¿
- âœ… Pydanticã‚¹ã‚­ãƒ¼ãƒã§å…¥å‡ºåŠ›ã‚’æ˜ç¤º
- âœ… ä¾å­˜æ€§æ³¨å…¥ã‚’æ´»ç”¨

### 5.3 Service Layerï¼ˆservices/ï¼‰

**è²¬ä»»**:

- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆcommit/rollbackï¼‰
- è¤‡æ•°ãƒªãƒã‚¸ãƒˆãƒªã®èª¿æ•´
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã®å®Ÿæ–½

**ä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹**:

| ã‚µãƒ¼ãƒ“ã‚¹ | è²¬ä»» | ä¾å­˜ãƒªãƒã‚¸ãƒˆãƒª |
|---------|------|---------------|
| `UserService` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€Azure ADé€£æº | `UserRepository` |
| `ProjectService` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆCRUDã€æ¨©é™ãƒã‚§ãƒƒã‚¯ | `ProjectRepository`, `ProjectMemberRepository` |
| `ProjectMemberFacade` | ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `ProjectMemberRepository`, `UserRepository`, `ProjectRepository` |
| `AnalysisService` | ãƒ‡ãƒ¼ã‚¿åˆ†æã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | `AnalysisSessionRepository`, `ProjectRepository` |
| `FileService` | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | `FileRepository`, `StorageService` |

**å®Ÿè£…ä¾‹ï¼ˆ`services/user.py`ï¼‰**:

```python
from app.repositories.user import UserRepository

class UserService:
    def __init__(self, db: AsyncSession):
        self.repository = UserRepository(db)
        self.db = db

    async def get_or_create_by_azure_oid(
        self,
        azure_oid: str,
        email: str,
        display_name: str | None = None,
        roles: list[str] | None = None,
    ) -> User:
        """Azure OIDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã€å­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆã—ã¾ã™ã€‚"""
        # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
        user = await self.repository.get_by_azure_oid(azure_oid)
        if not user:
            user = await self.repository.create(
                azure_oid=azure_oid,
                email=email,
                display_name=display_name,
                roles=roles or ["user"],
            )
            await self.db.commit()
        return user
```

**è¨­è¨ˆæŒ‡é‡**:

- âœ… 1ã‚µãƒ¼ãƒ“ã‚¹ = 1ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆSRPï¼‰
- âœ… ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ç®¡ç†
- âœ… Facadeãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¤‡é›‘ãªæ“ä½œã‚’å˜ç´”åŒ–
- âœ… å†åˆ©ç”¨å¯èƒ½ãªå°ã•ãªãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ†å‰²

### 5.4 Repository Layerï¼ˆrepositories/ï¼‰

**è²¬ä»»**:

- ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–
- SQLã‚¯ã‚¨ãƒªã®æ§‹ç¯‰ã¨å®Ÿè¡Œ
- CRUDæ“ä½œã®æä¾›

**BaseRepositoryï¼ˆå…±é€šCRUDï¼‰**:

```python
class BaseRepository[ModelType: Base, IDType: (int, uuid.UUID)]:
    """SQLAlchemyãƒ¢ãƒ‡ãƒ«ã®å…±é€šCRUDæ“ä½œã‚’æä¾›ã™ã‚‹ãƒ™ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ©ã‚¹ã€‚"""

    def __init__(self, model: type[ModelType], db: AsyncSession):
        self.model = model
        self.db = db

    async def get(self, id: IDType) -> ModelType | None:
        """IDã«ã‚ˆã£ã¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚"""
        return await self.db.get(self.model, id)

    async def get_multi(
        self,
        skip: int = 0,
        limit: int = 100,
        order_by: str | None = None,
        load_relations: list[str] | None = None,
        **filters: Any,
    ) -> list[ModelType]:
        """ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§è¤‡æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚"""
        # å®Ÿè£…çœç•¥ï¼ˆN+1ã‚¯ã‚¨ãƒªå¯¾ç­–ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ã‚½ãƒ¼ãƒˆï¼‰

    async def create(self, **obj_in: Any) -> ModelType:
        """æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ï¼ˆflush()ã®ã¿ã€commit()ã¯å‘¼ã³å‡ºã—å´ï¼‰ã€‚"""
        db_obj = self.model(**obj_in)
        self.db.add(db_obj)
        await self.db.flush()
        await self.db.refresh(db_obj)
        return db_obj

    async def update(self, db_obj: ModelType, **update_data: Any) -> ModelType:
        """æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã™ã€‚"""
        for field, value in update_data.items():
            if hasattr(db_obj, field):
                setattr(db_obj, field, value)
        await self.db.flush()
        await self.db.refresh(db_obj)
        return db_obj

    async def delete(self, id: IDType) -> bool:
        """ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã€‚"""
        db_obj = await self.get(id)
        if db_obj:
            await self.db.delete(db_obj)
            await self.db.flush()
            return True
        return False

    async def count(self, **filters: Any) -> int:
        """ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç·æ•°ã‚’å–å¾—ã—ã¾ã™ã€‚"""
        # å®Ÿè£…çœç•¥
```

**ã‚«ã‚¹ã‚¿ãƒ ãƒªãƒã‚¸ãƒˆãƒªï¼ˆ`repositories/user.py`ï¼‰**:

```python
class UserRepository(BaseRepository[User, uuid.UUID]):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ©ã‚¹ã€‚"""

    def __init__(self, db: AsyncSession):
        super().__init__(User, db)

    async def get_by_email(self, email: str) -> User | None:
        """ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚"""
        result = await self.db.execute(
            select(User).where(User.email == email)
        )
        return result.scalar_one_or_none()

    async def get_by_azure_oid(self, azure_oid: str) -> User | None:
        """Azure OIDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚"""
        result = await self.db.execute(
            select(User).where(User.azure_oid == azure_oid)
        )
        return result.scalar_one_or_none()
```

**è¨­è¨ˆæŒ‡é‡**:

- âœ… BaseRepositoryã‚’ç¶™æ‰¿ã—ã¦DRYåŸå‰‡ã‚’å®Ÿç¾
- âœ… ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹`[ModelType, IDType]`ã§å‹å®‰å…¨æ€§ç¢ºä¿
- âœ… `flush()`ã®ã¿å®Ÿè¡Œã€`commit()`ã¯ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®è²¬ä»»
- âœ… N+1ã‚¯ã‚¨ãƒªå¯¾ç­–ï¼ˆ`load_relations`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰

### 5.5 Data Layerï¼ˆmodels/ï¼‰

**è²¬ä»»**:

- SQLAlchemyãƒ¢ãƒ‡ãƒ«å®šç¾©
- ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®å®šç¾©
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®å®šç¾©

**Base & Mixins**:

```python
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column

class Base(DeclarativeBase):
    """ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼ˆORMã‚¯ãƒ©ã‚¹ï¼‰ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã€‚"""
    pass

class PrimaryKeyMixin:
    """ä¸»ã‚­ãƒ¼ï¼ˆidï¼‰ã‚’æä¾›ã™ã‚‹ãƒŸãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã€‚"""
    @declared_attr
    def id(cls) -> Mapped[uuid.UUID]:
        return mapped_column(
            UUID(as_uuid=True),
            primary_key=True,
            default=uuid.uuid4,
            index=True,
        )

class TimestampMixin:
    """ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æä¾›ã™ã‚‹ãƒŸãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã€‚"""
    @declared_attr
    def created_at(cls) -> Mapped[datetime]:
        return mapped_column(
            DateTime(timezone=True),
            default=lambda: datetime.now(UTC),
            nullable=False,
        )

    @declared_attr
    def updated_at(cls) -> Mapped[datetime]:
        return mapped_column(
            DateTime(timezone=True),
            default=lambda: datetime.now(UTC),
            onupdate=lambda: datetime.now(UTC),
            nullable=False,
        )
```

**ãƒ¢ãƒ‡ãƒ«ä¾‹ï¼ˆ`models/user.py`ï¼‰**:

```python
from app.models.base import Base, PrimaryKeyMixin, TimestampMixin

class User(Base, PrimaryKeyMixin, TimestampMixin):
    __tablename__ = "users"

    # ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
    azure_oid: Mapped[str] = mapped_column(String(100), unique=True, index=True)
    email: Mapped[str] = mapped_column(String(255), unique=True, index=True)
    display_name: Mapped[str | None] = mapped_column(String(255), nullable=True)
    roles: Mapped[list[str]] = mapped_column(JSON, default=list)
    is_active: Mapped[bool] = mapped_column(Boolean, default=True)

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    projects: Mapped[list["Project"]] = relationship(
        "Project", secondary="project_members", back_populates="members"
    )
```

**è¨­è¨ˆæŒ‡é‡**:

- âœ… Mixinã§å…±é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¸€å…ƒåŒ–
- âœ… SQLAlchemy 2.0ã®Mappedå‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
- âœ… UUID v4ä¸»ã‚­ãƒ¼ã§åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ
- âœ… JSONBå‹ã§æŸ”è»Ÿãªã‚¹ã‚­ãƒ¼ãƒå¯¾å¿œ

---

## 6. ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰

### 6.1 FastAPI Dependsã‚·ã‚¹ãƒ†ãƒ 

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯FastAPIã®`Depends`æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ãŸä¾å­˜æ€§æ³¨å…¥ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

**DIå®šç¾©ï¼ˆ`api/core/dependencies.py`ï¼‰**:

```python
from typing import Annotated
from fastapi import Depends
from sqlalchemy.ext.asyncio import AsyncSession

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¾å­˜æ€§
from app.core.database import get_db
DatabaseDep = Annotated[AsyncSession, Depends(get_db)]

# ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜æ€§
def get_azure_user_service(db: DatabaseDep) -> UserService:
    return UserService(db)

AzureUserServiceDep = Annotated[UserService, Depends(get_azure_user_service)]

# èªè¨¼ä¾å­˜æ€§
async def get_authenticated_user_from_azure(
    user_service: AzureUserServiceDep,
    azure_user: Any = Depends(get_current_azure_user),
) -> User:
    user = await user_service.get_or_create_by_azure_oid(
        azure_oid=azure_user.oid,
        email=azure_user.email,
        display_name=getattr(azure_user, "name", None),
    )
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    return user

CurrentUserAzureDep = Annotated[User, Depends(get_authenticated_user_from_azure)]
```

### 6.2 ä¾å­˜æ€§ã‚°ãƒ©ãƒ•

```mermaid
graph TB
    Endpoint[ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–¢æ•°]

    Endpoint -->|Depends| CurrentUser[CurrentUserAzureDep<br/>èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    Endpoint -->|Depends| ProjectService[ProjectServiceDep<br/>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒ¼ãƒ“ã‚¹]

    CurrentUser -->|Depends| UserService[AzureUserServiceDep<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹]
    CurrentUser -->|Depends| AzureUser[AzureUser<br/>Azure ADæ¤œè¨¼]

    UserService -->|Depends| DB1[DatabaseDep<br/>DBã‚»ãƒƒã‚·ãƒ§ãƒ³]
    ProjectService -->|Depends| DB2[DatabaseDep<br/>DBã‚»ãƒƒã‚·ãƒ§ãƒ³]

    DB1 -->|ç”Ÿæˆ| Session1[AsyncSession]
    DB2 -->|ç”Ÿæˆ| Session2[AsyncSession]

    style Endpoint fill:#e3f2fd
    style CurrentUser fill:#fff9c4
    style UserService fill:#c8e6c9
    style DB1 fill:#ffccbc
```

**åˆ©ç‚¹**:

- âœ… **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆå¯èƒ½
- âœ… **ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨**: DIå®šç¾©ã‚’è¤‡æ•°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å…±æœ‰
- âœ… **æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚**: å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¾å­˜é–¢ä¿‚ãŒæ˜ç¢º
- âœ… **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚º

---

## 7. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

### 7.1 create_app()é–¢æ•°

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã¯`core/app_factory.py`ã®`create_app()`é–¢æ•°ã§é›†ä¸­ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

**å®Ÿè£…ï¼ˆ`core/app_factory.py`ï¼‰**:

```python
from fastapi import FastAPI
from app.core.config import settings

def create_app() -> FastAPI:
    """FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚"""

    # FastAPIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    app = FastAPI(
        title=settings.APP_NAME,
        version=settings.VERSION,
        description="LangChain/LangGraphã‚’ä½¿ç”¨ã—ãŸAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆAPI",
        lifespan=lifespan,
        docs_url="/docs",
        redoc_url="/redoc",
    )

    # ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç™»éŒ²
    register_exception_handlers(app)

    # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ç™»éŒ²ï¼ˆå®Ÿè¡Œé †åºã¯ç™»éŒ²ã®é€†é †ï¼‰
    app.add_middleware(PrometheusMetricsMiddleware)
    app.add_middleware(ErrorHandlerMiddleware)
    app.add_middleware(LoggingMiddleware)
    app.add_middleware(
        RateLimitMiddleware,
        calls=settings.RATE_LIMIT_CALLS,
        period=settings.RATE_LIMIT_PERIOD,
    )
    app.add_middleware(
        CORSMiddleware,
        allow_origins=settings.ALLOWED_ORIGINS or [],
        allow_credentials=True,
        allow_methods=["GET", "POST", "PUT", "DELETE", "PATCH"],
        allow_headers=["Accept", "Content-Type", "Authorization", "X-API-Key"],
    )
    app.add_middleware(SecurityHeadersMiddleware)

    # ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç™»éŒ²
    app.include_router(users.router, prefix="/api/v1/users", tags=["users"])
    app.include_router(projects.router, prefix="/api/v1/projects", tags=["projects"])
    app.include_router(health.router, tags=["health"])
    app.include_router(metrics.router, tags=["metrics"])

    return app
```

### 7.2 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚¹ã‚¿ãƒƒã‚¯

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ä»¥ä¸‹ã®é †åºã§ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é€šéã—ã¾ã™ï¼š

```text
 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â†“
[CORS Middleware] â† ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡
    â†“
[RateLimitMiddleware] â† 100req/minåˆ¶é™
    â†“
[LoggingMiddleware] â† æ§‹é€ åŒ–ãƒ­ã‚°è¨˜éŒ²
    â†“
[ErrorHandlerMiddleware] â† ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    â†“
[PrometheusMetricsMiddleware] â† ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
    â†“
[Router] â† ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå‡¦ç†
    â†“
ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```

**å„ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è²¬ä»»**:

| ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ | è²¬ä»» | å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« |
|------------|------|-------------|
| `SecurityHeadersMiddleware` | X-Content-Type-Options, X-Frame-Options, HSTSè¿½åŠ  | `api/middlewares/security_headers.py` |
| `CORSMiddleware` | CORSåˆ¶å¾¡ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯å³æ ¼åŒ–ï¼‰ | FastAPIçµ„ã¿è¾¼ã¿ |
| `RateLimitMiddleware` | 100req/minåˆ¶é™ã€IPãƒ™ãƒ¼ã‚¹ | `api/middlewares/rate_limit.py` |
| `LoggingMiddleware` | æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆstructlogï¼‰ | `api/middlewares/logging.py` |
| `ErrorHandlerMiddleware` | ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒã¨æ•´å½¢ | `api/middlewares/error_handler.py` |
| `PrometheusMetricsMiddleware` | ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼‰ | `api/middlewares/metrics.py` |

---

## 8. è¨­å®šç®¡ç†

### 8.1 ç’°å¢ƒåˆ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

è¨­å®šã¯ç’°å¢ƒå¤‰æ•°ã¨`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã€`core/config.py`ã§é›†ç´„ã•ã‚Œã¾ã™ã€‚

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å„ªå…ˆé †ä½**:

```text
1. ç’°å¢ƒå¤‰æ•°ï¼ˆæœ€å„ªå…ˆï¼‰
2. .env.{environment}ï¼ˆç’°å¢ƒåˆ¥è¨­å®šï¼‰
   - .env.local (development)
   - .env.staging (staging)
   - .env.production (production)
3. .envï¼ˆå…±é€šè¨­å®šï¼‰
4. Settingsã‚¯ãƒ©ã‚¹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```

### 8.2 Settings ã‚¯ãƒ©ã‚¹ï¼ˆPydantic Settingsï¼‰

**å®Ÿè£…ï¼ˆ`core/config.py`ï¼‰**:

```python
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    """ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚¯ãƒ©ã‚¹ã€‚"""

    model_config = SettingsConfigDict(
        env_file=get_env_file(),
        env_file_encoding="utf-8",
        case_sensitive=True,
        extra="ignore",
    )

    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
    APP_NAME: str = "camp-backend"
    VERSION: str = "0.1.0"
    DEBUG: bool = False
    ENVIRONMENT: Literal["development", "staging", "production"] = "development"

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
    SECRET_KEY: str = Field(min_length=32)
    ALLOWED_ORIGINS: list[str] | None = None

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
    DATABASE_URL: str = "postgresql+asyncpg://postgres:postgres@localhost:5432/app_db"
    DB_POOL_SIZE: int = 5
    DB_MAX_OVERFLOW: int = 10
    DB_POOL_RECYCLE: int = 1800
    DB_POOL_PRE_PING: bool = True

    # LLMè¨­å®š
    LLM_PROVIDER: Literal["anthropic", "openai", "azure_openai"] = "anthropic"
    LLM_MODEL: str = "claude-3-5-sonnet-20241022"
    ANTHROPIC_API_KEY: str | None = None

    # Azure ADè¨­å®š
    AUTH_MODE: Literal["development", "production"] = "development"
    AZURE_TENANT_ID: str | None = None
    AZURE_CLIENT_ID: str | None = None

    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self._validate_cors_settings()
        self._validate_security_settings()
        self._validate_llm_config()
        self._validate_azure_ad_config()

settings = Settings()
```

### 8.3 ç’°å¢ƒåˆ¥ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**æœ¬ç•ªç’°å¢ƒã§ã®å¿…é ˆãƒã‚§ãƒƒã‚¯**:

- âœ… SECRET_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆ32æ–‡å­—ä»¥ä¸Šï¼‰
- âœ… ALLOWED_ORIGINSãŒæ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… LLM_PROVIDERã«å¯¾å¿œã™ã‚‹APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… AUTH_MODE=productionã®å ´åˆã€Azure ADè¨­å®šãŒå­˜åœ¨ã™ã‚‹ã‹

**é–‹ç™ºç’°å¢ƒã§ã®è­¦å‘Š**:

- âš ï¸ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆSECRET_KEYä½¿ç”¨æ™‚ã¯è­¦å‘Šãƒ­ã‚°ã‚’å‡ºåŠ›

---

## 9. ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

### 9.1 lifespan ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ãƒ»çµ‚äº†å‡¦ç†ã¯`core/lifespan.py`ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚

**å®Ÿè£…ï¼ˆ`core/lifespan.py`ï¼‰**:

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI

@asynccontextmanager
async def lifespan(app: FastAPI):
    """ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼ˆèµ·å‹•ãƒ»çµ‚äº†ï¼‰ã‚’ç®¡ç†ã—ã¾ã™ã€‚"""

    # èµ·å‹•æ™‚å‡¦ç†
    logger.info("ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•", app_name=settings.APP_NAME, version=settings.VERSION)
    logger.info("ç’°å¢ƒæƒ…å ±", environment=settings.ENVIRONMENT)

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèªãƒ»ä½œæˆ
    await init_db()
    logger.info("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ")

    # Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆæœŸåŒ–
    if settings.REDIS_URL:
        await cache_manager.connect()
        logger.info("Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ¥ç¶šã—ã¾ã—ãŸ")

    # Azure ADèªè¨¼ã®åˆæœŸåŒ–ï¼ˆæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰
    if settings.AUTH_MODE == "production":
        try:
            from app.core.security.azure_ad import initialize_azure_scheme
            await initialize_azure_scheme()
            logger.info("Azure ADèªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ")
        except Exception as e:
            logger.error("Azure ADåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼", error=str(e))

    yield

    # çµ‚äº†æ™‚å‡¦ç†
    logger.info("ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ä¸­...")

    # Redisæ¥ç¶šã‚’åˆ‡æ–­
    if settings.REDIS_URL:
        await cache_manager.disconnect()
        logger.info("Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰åˆ‡æ–­ã—ã¾ã—ãŸ")

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ã‚¯ãƒ­ãƒ¼ã‚º
    await close_db()
    logger.info("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ")
```

### 9.2 èµ·å‹•æ™‚å‡¦ç†

1. **ãƒ­ã‚°å‡ºåŠ›**: ã‚¢ãƒ—ãƒªåã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ç’°å¢ƒã‚’è¨˜éŒ²
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–**: `init_db()`ã§ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèªï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ä½œæˆï¼‰
3. **Redisæ¥ç¶š**: `REDIS_URL`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°æ¥ç¶š
4. **Azure ADåˆæœŸåŒ–**: æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã‚’åˆæœŸåŒ–

### 9.3 çµ‚äº†æ™‚å‡¦ç†

1. **Redisåˆ‡æ–­**: gracefulã«æ¥ç¶šã‚’åˆ‡æ–­
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ­ãƒ¼ã‚º**: ã™ã¹ã¦ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã‚’è§£æ”¾

---

## 10. ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³

### 10.1 Facadeãƒ‘ã‚¿ãƒ¼ãƒ³

**é©ç”¨å ´æ‰€**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ï¼ˆ`services/project_member/member_facade.py`ï¼‰

**ç›®çš„**: è¤‡é›‘ãªã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãƒ»æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼‰ã‚’å˜ä¸€ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§çµ±ä¸€

**å®Ÿè£…**:

```python
class ProjectMemberFacade:
    """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã®Facadeã‚¯ãƒ©ã‚¹ã€‚"""

    def __init__(self, db: AsyncSession):
        self.db = db
        self.auth_checker = ProjectMemberAuthorizationChecker(db)
        self.adder = ProjectMemberAdder(db)
        self.updater = ProjectMemberUpdater(db)
        self.remover = ProjectMemberRemover(db)

    async def add_member(
        self,
        project_id: uuid.UUID,
        user_id: uuid.UUID,
        role: ProjectRole,
        requester_id: uuid.UUID,
    ) -> ProjectMember:
        """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ï¼ˆæ¨©é™ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰ã€‚"""
        # æ¨©é™ãƒã‚§ãƒƒã‚¯ â†’ å®Ÿè¡Œ â†’ commit ã‚’ä¸€æ‹¬ã§ç®¡ç†
        return await self.adder.add_member(project_id, user_id, role, requester_id)

    async def update_member_role(
        self,
        project_id: uuid.UUID,
        member_id: uuid.UUID,
        new_role: ProjectRole,
        requester_id: uuid.UUID,
    ) -> ProjectMember:
        """ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ï¼ˆæ¨©é™ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰ã€‚"""
        return await self.updater.update_member_role(project_id, member_id, new_role, requester_id)

    async def remove_member(
        self,
        project_id: uuid.UUID,
        member_id: uuid.UUID,
        requester_id: uuid.UUID,
    ) -> None:
        """ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆæ¨©é™ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰ã€‚"""
        await self.remover.remove_member(project_id, member_id, requester_id)
```

**åˆ©ç‚¹**:

- âœ… è¤‡é›‘ãªæ“ä½œã‚’å˜ç´”ãªãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã«éš è”½
- âœ… å„å°‚é–€ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAdder, Updater, Removerï¼‰ã®èª¿æ•´
- âœ… APIãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®å‘¼ã³å‡ºã—ãŒç°¡æ½”

### 10.2 Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³

**é©ç”¨å ´æ‰€**: ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ`repositories/base.py`ï¼‰

**ç›®çš„**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‹ã‚‰åˆ†é›¢

**å®Ÿè£…**: å‰è¿°ã®ã€Œ5.4 Repository Layerã€ã‚’å‚ç…§

**åˆ©ç‚¹**:

- âœ… ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼ˆãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆå¯èƒ½ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å¤‰æ›´æ™‚ã®å½±éŸ¿ã‚’å±€æ‰€åŒ–
- âœ… CRUDæ“ä½œã®ä¸€å…ƒåŒ–ï¼ˆDRYåŸå‰‡ï¼‰

### 10.3 Dependency Injectionï¼ˆDIï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³

**é©ç”¨å ´æ‰€**: FastAPIã®Dependsã‚·ã‚¹ãƒ†ãƒ 

**ç›®çš„**: ä¾å­˜é–¢ä¿‚ã‚’å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã—ã€ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã¨ä¿å®ˆæ€§ã‚’å‘ä¸Š

**å®Ÿè£…**: å‰è¿°ã®ã€Œ6. ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã€ã‚’å‚ç…§

**åˆ©ç‚¹**:

- âœ… ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š
- âœ… ç–çµåˆ
- âœ… æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚

### 10.4 Strategyãƒ‘ã‚¿ãƒ¼ãƒ³

**é©ç”¨å ´æ‰€**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`services/storage.py`ï¼‰

**ç›®çš„**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…ï¼ˆLocal / Azure Blobï¼‰ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã™ã‚‹

**å®Ÿè£…**:

```python
class StorageService:
    def __init__(self):
        if settings.STORAGE_BACKEND == "azure":
            self.backend = AzureBlobStorage()
        else:
            self.backend = LocalFileStorage()

    async def upload(self, file: UploadFile, path: str) -> str:
        return await self.backend.upload(file, path)

    async def download(self, path: str) -> bytes:
        return await self.backend.download(path)
```

**åˆ©ç‚¹**:

- âœ… å®Ÿè¡Œæ™‚ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ
- âœ… æ–°ã—ã„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¿½åŠ ãŒå®¹æ˜“ï¼ˆOpen/ClosedåŸå‰‡ï¼‰

---

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 11.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ—ãƒ¼ãƒ«

**è¨­å®šï¼ˆ`core/database.py`ï¼‰**:

```python
engine = create_async_engine(
    settings.DATABASE_URL,
    pool_size=5,           # é€šå¸¸æ™‚ã®æ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º
    max_overflow=10,       # ãƒ”ãƒ¼ã‚¯æ™‚ã®è¿½åŠ æ¥ç¶šæ•°ï¼ˆæœ€å¤§15æ¥ç¶šï¼‰
    pool_recycle=1800,     # 30åˆ†ã§æ¥ç¶šã‚’ãƒªã‚µã‚¤ã‚¯ãƒ«
    pool_pre_ping=True,    # æ¥ç¶šå‰ã«PINGãƒã‚§ãƒƒã‚¯ï¼ˆåˆ‡æ–­æ¤œå‡ºï¼‰
    echo=settings.DEBUG,   # SQLå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°æ™‚ã®ã¿ï¼‰
)
```

**æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ**:

- âœ… `pool_pre_ping=True`: åˆ‡æ–­ã•ã‚ŒãŸæ¥ç¶šã‚’è‡ªå‹•æ¤œå‡ºãƒ»å†æ¥ç¶š
- âœ… `pool_recycle=1800`: é•·æ™‚é–“æ¥ç¶šã‚’å®šæœŸçš„ã«ãƒªã‚µã‚¤ã‚¯ãƒ«
- âœ… `pool_size + max_overflow`: é€šå¸¸5æ¥ç¶šã€ãƒ”ãƒ¼ã‚¯æ™‚15æ¥ç¶š

### 11.2 N+1ã‚¯ã‚¨ãƒªå¯¾ç­–

**å•é¡Œ**: ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®é…å»¶ãƒ­ãƒ¼ãƒ‰ï¼ˆLazy Loadingï¼‰ã«ã‚ˆã‚‹N+1ã‚¯ã‚¨ãƒª

**è§£æ±ºç­–**: `selectinload`ã«ã‚ˆã‚‹Eager Loading

**å®Ÿè£…ï¼ˆ`repositories/base.py`ï¼‰**:

```python
async def get_multi(
    self,
    skip: int = 0,
    limit: int = 100,
    load_relations: list[str] | None = None,
    **filters: Any,
) -> list[ModelType]:
    """N+1ã‚¯ã‚¨ãƒªå¯¾ç­–ä»˜ãã§è¤‡æ•°ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚"""
    from sqlalchemy.orm import selectinload

    query = select(self.model)

    # Eager loadingï¼ˆN+1ã‚¯ã‚¨ãƒªå¯¾ç­–ï¼‰
    if load_relations:
        for relation in load_relations:
            if hasattr(self.model, relation):
                query = query.options(selectinload(getattr(self.model, relation)))

    # ãƒ•ã‚£ãƒ«ã‚¿ã€ã‚½ãƒ¼ãƒˆã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
    # ...ï¼ˆçœç•¥ï¼‰
```

**ä½¿ç”¨ä¾‹**:

```python
# âŒ N+1ã‚¯ã‚¨ãƒªãŒç™ºç”Ÿï¼ˆæ‚ªã„ä¾‹ï¼‰
users = await user_repo.get_multi(limit=10)
for user in users:
    print(user.projects)  # å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ã‚¯ã‚¨ãƒªç™ºè¡Œï¼ˆ10å› + 1å› = 11ã‚¯ã‚¨ãƒªï¼‰

# âœ… Eager Loadingã§1ã‚¯ã‚¨ãƒªï¼ˆè‰¯ã„ä¾‹ï¼‰
users = await user_repo.get_multi(limit=10, load_relations=["projects"])
for user in users:
    print(user.projects)  # ã™ã§ã«ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ï¼ˆ1ã‚¯ã‚¨ãƒªã®ã¿ï¼‰
```

### 11.3 Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥

**å®Ÿè£…ï¼ˆ`core/cache.py`ï¼‰**:

```python
class CacheManager:
    def __init__(self):
        self.redis: Redis | None = None

    async def connect(self):
        self.redis = await Redis.from_url(
            settings.REDIS_URL,
            encoding="utf-8",
            decode_responses=True,
        )

    async def get(self, key: str) -> Any:
        if not self.redis:
            return None
        value = await self.redis.get(key)
        return json.loads(value) if value else None

    async def set(self, key: str, value: Any, ttl: int = settings.CACHE_TTL):
        if self.redis:
            await self.redis.set(key, json.dumps(value), ex=ttl)
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**:

- âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ãƒ­ãƒ¼ãƒ«ï¼ˆTTL: 5åˆ†ï¼‰
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆTTL: 5åˆ†ï¼‰
- âœ… åˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ï¼ˆTTL: 10åˆ†ï¼‰

### 11.4 éåŒæœŸI/O

**FastAPI + SQLAlchemy 2.0 + asyncpg**:

- âœ… ã™ã¹ã¦ã®I/Oæ“ä½œãŒéåŒæœŸï¼ˆ`async/await`ï¼‰
- âœ… åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†èƒ½åŠ›ã®å‘ä¸Š
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ•ã‚¡ã‚¤ãƒ«I/Oã€å¤–éƒ¨APIå‘¼ã³å‡ºã—ãŒãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°

**å®Ÿè£…ä¾‹**:

```python
async def get_user_with_projects(user_id: uuid.UUID) -> User:
    """éåŒæœŸã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸¦è¡Œå–å¾—ã—ã¾ã™ã€‚"""
    async with get_db() as db:
        user_repo = UserRepository(db)
        project_repo = ProjectRepository(db)

        # ä¸¦è¡Œå®Ÿè¡Œï¼ˆasyncio.gatherï¼‰
        user, projects = await asyncio.gather(
            user_repo.get(user_id),
            project_repo.get_by_user(user_id),
        )

        return user
```

---

## 12. ä»˜éŒ²

### 12.1 é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### ã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `src/app/main.py` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ |
| `src/app/core/app_factory.py` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼ˆcreate_appé–¢æ•°ï¼‰ |
| `src/app/core/config.py` | è¨­å®šç®¡ç†ï¼ˆPydantic Settingsï¼‰ |
| `src/app/core/database.py` | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| `src/app/core/lifespan.py` | ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼ˆèµ·å‹•ãƒ»çµ‚äº†å‡¦ç†ï¼‰ |
| `src/app/core/logging.py` | ãƒ­ã‚°è¨­å®šï¼ˆstructlogï¼‰ |
| `src/app/core/cache.py` | Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç† |
| `src/app/core/exceptions.py` | ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–å®šç¾© |
| `src/app/core/security/` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ï¼ˆèªè¨¼ãƒ»èªå¯ï¼‰ |

#### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | èª¬æ˜ |
|---------|-------------|------|
| API Layer | `src/app/api/routes/` | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾© |
| | `src/app/api/core/` | DIå®šç¾©ã€ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ |
| | `src/app/api/middlewares/` | ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ |
| Service Layer | `src/app/services/` | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
| Repository Layer | `src/app/repositories/` | ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
| Data Layer | `src/app/models/` | SQLAlchemyãƒ¢ãƒ‡ãƒ« |

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `pyproject.toml` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ»ä¾å­˜é–¢ä¿‚ |
| `uv.lock` | ä¾å­˜é–¢ä¿‚ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ« |
| `.env.local.example` | é–‹ç™ºç’°å¢ƒè¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| `src/alembic.ini` | Alembicè¨­å®šãƒ•ã‚¡ã‚¤ãƒ« |

### 12.2 å‚è€ƒãƒªãƒ³ã‚¯

#### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.0 Documentation](https://docs.sqlalchemy.org/en/20/)
- [Pydantic Documentation](https://docs.pydantic.dev/)
- [LangChain Documentation](https://python.langchain.com/)
- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)

#### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

- [Repository Pattern](https://martinfowler.com/eaaCatalog/repository.html)
- [Facade Pattern](https://refactoring.guru/design-patterns/facade)
- [Dependency Injection](https://martinfowler.com/articles/injection.html)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

### 12.3 ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| **ASGI** | Asynchronous Server Gateway Interfaceï¼ˆéåŒæœŸWebã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ |
| **ORM** | Object-Relational Mappingï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–¢ä¿‚ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰ |
| **DI** | Dependency Injectionï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ |
| **CRUD** | Create, Read, Update, Deleteï¼ˆåŸºæœ¬ãƒ‡ãƒ¼ã‚¿æ“ä½œï¼‰ |
| **RBAC** | Role-Based Access Controlï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰ |
| **UUID** | Universally Unique Identifierï¼ˆæ±ç”¨ä¸€æ„è­˜åˆ¥å­ï¼‰ |
| **JSONB** | PostgreSQLã®ãƒã‚¤ãƒŠãƒªJSONå‹ |
| **N+1ã‚¯ã‚¨ãƒª** | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®é…å»¶ãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹è¤‡æ•°ã‚¯ã‚¨ãƒªç™ºè¡Œå•é¡Œ |
| **Eager Loading** | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®äº‹å‰ãƒ­ãƒ¼ãƒ‰ï¼ˆN+1å¯¾ç­–ï¼‰ |
| **Middleware** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†ã®ä¸­é–“å±¤ |

### 12.4 ã‚¯ãƒ­ã‚¹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

æœ¬è¨­è¨ˆæ›¸ã«é–¢é€£ã™ã‚‹ä»–ã®è¨­è¨ˆæ›¸ï¼š

| è¨­è¨ˆæ›¸ | ãƒªãƒ³ã‚¯ | é–¢é€£ç®‡æ‰€ |
|-------|--------|---------|
| **Databaseè¨­è¨ˆæ›¸** | [01-database-design.md](../02-database/01-database-design.md) | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |
| **RBACè¨­è¨ˆæ›¸** | [01-rbac-design.md](../03-security/01-rbac-design.md) | èªè¨¼ãƒ»èªå¯ã€ãƒ­ãƒ¼ãƒ«å®šç¾©ã€æ¨©é™ãƒã‚§ãƒƒã‚¯ |
| **APIè¨­è¨ˆæ›¸** | [01-api-design.md](../04-api/01-api-design.md) | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |

### 12.5 å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 1.0.0 | 2025-01-11 | åˆç‰ˆä½œæˆ | Claude Code |

---

**æœ€çµ‚æ›´æ–°**: 2025-01-11
**ç®¡ç†è€…**: Claude Code
**ãƒ¬ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹**: åˆç‰ˆ
