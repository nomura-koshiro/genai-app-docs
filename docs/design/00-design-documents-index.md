# 設計書一覧

このドキュメントは、camp-backendプロジェクトで作成する設計書の一覧です。

**作成日**: 2025-01-06
**プロジェクト**: camp-backend (FastAPI + LangChain/LangGraph AI Agent & File Management Backend)

---

## 📋 基本設計書（必須）

以下は、プロジェクトの基本的な理解に必要な必須の設計書です。

### 1. システム構成図
**ファイル**: `01-system-architecture.md`

**内容**:
- システム全体のアーキテクチャ図（Mermaid）
- レイヤードアーキテクチャの説明
- 技術スタック一覧
- 各レイヤーの責務
- ディレクトリ構造と対応関係

**対象読者**: 開発者全般、新規参加者

---

### 2. RBAC設計書
**ファイル**: `02-rbac-design.md`

**内容**:
- 権限システムの概要
- システムロール（SystemRole）
  - SYSTEM_ADMIN
  - USER
- プロジェクトロール（ProjectRole）
  - PROJECT_MANAGER
  - PROJECT_MODERATOR
  - MEMBER
  - VIEWER
- 権限マトリックス（操作 × ロール）
- 権限チェックフロー
- セキュリティ考慮事項

**対象読者**: 開発者全般、セキュリティ担当者

---

### 3. データベース設計書
**ファイル**: `03-database-design.md`

**内容**:
- データベース概要（PostgreSQL）
- 全テーブル定義
  - users
  - projects
  - project_members
  - project_files
  - sample_users
  - sample_sessions
  - sample_files
- カラム定義（型、制約、デフォルト値）
- インデックス設計
- 外部キー制約
- マイグレーション戦略

**対象読者**: バックエンド開発者、DBA

---

### 4. ER図
**ファイル**: `04-er-diagram.md`

**内容**:
- エンティティリレーションシップ図（Mermaid）
- テーブル間のリレーションシップ
  - 1対多
  - 多対多
- カーディナリティ
- 主要なビジネスルール

**対象読者**: 開発者全般、設計者

---

### 5. API一覧
**ファイル**: `05-api-list.md`

**内容**:
- 全APIエンドポイント一覧
- エンドポイントのグループ化
  - システムAPI（health, metrics）
  - 認証API
  - ユーザーAPI
  - プロジェクトAPI
  - プロジェクトメンバーAPI
  - プロジェクトファイルAPI
  - サンプルAPI（Agents, Sessions, Files, Users）
- HTTPメソッド、パス、概要
- 必要な権限
- レスポンスコード一覧

**対象読者**: フロントエンド開発者、API利用者

---

### 6. API詳細仕様書
**ファイル**: `06-api-specifications/`（ディレクトリ）

**内容**: 各APIの詳細仕様（個別ファイル）
- リクエスト仕様
  - パスパラメータ
  - クエリパラメータ
  - リクエストボディ（JSONスキーマ）
- レスポンス仕様
  - 成功レスポンス（200, 201, 204）
  - エラーレスポンス（400, 401, 403, 404, 422, 500）
- サンプルリクエスト/レスポンス
- 認証・認可要件
- 制限事項（レート制限、ファイルサイズ制限等）

**ファイル構成例**:
```
06-api-specifications/
├── system/
│   ├── health.md
│   └── metrics.md
├── auth/
│   └── login.md
├── users/
│   ├── get-users.md
│   └── get-user-by-id.md
├── projects/
│   ├── create-project.md
│   ├── get-projects.md
│   └── update-project.md
├── project-members/
│   ├── add-member.md
│   ├── update-member-role.md
│   └── remove-member.md
└── project-files/
    ├── upload-file.md
    └── download-file.md
```

**対象読者**: フロントエンド開発者、API利用者、QA

---

## 📚 追加設計書（推奨）

以下は、より深い理解やメンテナンスのために推奨される設計書です。

### 7. シーケンス図集
**ファイル**: `07-sequence-diagrams.md`

**内容**:
- 主要なビジネスフローのシーケンス図（Mermaid）
  - Azure AD認証フロー
  - プロジェクト作成〜メンバー追加フロー
  - ファイルアップロード/ダウンロードフロー
  - 権限チェックフロー（PROJECT_MANAGER、MEMBER、VIEWER）
  - AIエージェント実行フロー
  - 一括メンバー追加フロー

**対象読者**: 開発者全般、設計者

---

### 8. クラス図
**ファイル**: `08-class-diagram.md`

**内容**:
- レイヤードアーキテクチャのクラス構造（Mermaid）
- Model - Repository - Service - API の関係
- 依存性注入パターン
- 主要なクラス・インターフェース
- デコレータの使用パターン

**対象読者**: バックエンド開発者

---

### 9. セキュリティ設計書（詳細版）
**ファイル**: `09-security-design.md`

**内容**:
- 認証方式
  - Azure AD OAuth 2.0
  - 開発環境用認証
  - APIキー認証
- 認可方式
  - RBAC実装詳細
  - 権限チェックデコレータ
- データ保護
  - データベース暗号化
  - パスワードハッシュ化（bcrypt）
  - JWT署名
- ネットワークセキュリティ
  - CORS設定
  - CSP（Content Security Policy）
  - セキュリティヘッダー
- インフラセキュリティ
  - 環境変数管理
  - シークレット管理
- 脆弱性対策
  - SQL Injection対策（SQLAlchemy ORM）
  - XSS対策
  - CSRF対策
  - レート制限

**対象読者**: セキュリティ担当者、開発者全般

---

### 10. デプロイメント構成図
**ファイル**: `10-deployment-architecture.md`

**内容**:
- インフラ構成図（Mermaid）
  - ローカル環境
  - Azure環境
- コンポーネント配置
  - FastAPI サーバー
  - PostgreSQL データベース
  - Redis キャッシュ
  - Azure Blob Storage
- CI/CDパイプライン
  - GitHub Actions ワークフロー
  - テスト → ビルド → デプロイ
- 環境別設定
  - local（開発環境）
  - staging（ステージング環境）
  - production（本番環境）
- スケーリング戦略

**対象読者**: DevOps、インフラ担当者

---

### 11. データフロー図
**ファイル**: `11-data-flow-diagram.md`

**内容**:
- リクエストからレスポンスまでのデータ変換フロー（Mermaid）
- レイヤー間のデータ変換
  - Pydantic Schema → SQLAlchemy Model
  - Model → Schema
- ファイルアップロードのデータフロー
  - バリデーション → 一時保存 → ストレージ保存 → DB記録
- ファイルダウンロードのデータフロー
- キャッシュ戦略

**対象読者**: バックエンド開発者

---

### 12. ミドルウェア設計書
**ファイル**: `12-middleware-design.md`

**内容**:
- ミドルウェアスタック構成
- 各ミドルウェアの詳細
  - セキュリティヘッダーミドルウェア
  - レート制限ミドルウェア
  - ロギングミドルウェア
  - エラーハンドリングミドルウェア
  - メトリクスミドルウェア
- 実行順序と依存関係
- 設定オプション

**対象読者**: バックエンド開発者

---

### 13. ストレージ設計書
**ファイル**: `13-storage-design.md`

**内容**:
- ストレージ戦略
  - ローカルストレージ（開発環境）
  - Azure Blob Storage（本番環境）
- ファイル管理戦略
  - ディレクトリ構造
  - ファイル命名規則
  - メタデータ管理
- ストレージ切り替え設計
  - 設定による切り替え
  - ストレージインターフェース
- バックアップ戦略
- 容量管理

**対象読者**: バックエンド開発者、インフラ担当者

---

### 14. AI/LangChain統合設計書
**ファイル**: `14-ai-langchain-integration.md`

**内容**:
- LangChain/LangGraph アーキテクチャ
- AIエージェント構造
  - ツールサポート
  - ステートマシン
- LLMプロバイダー統合
  - Anthropic Claude
  - OpenAI GPT
  - Azure OpenAI
- プロバイダー切り替え設計
- LangSmithトレーシング
  - トレース収集
  - 可観測性
- プロンプトエンジニアリング
- エージェントセッション管理

**対象読者**: AI/ML担当者、バックエンド開発者

---

## 📊 設計書作成の優先順位

### P0（最優先 - 即座に作成）
- [x] 00. 設計書一覧（このドキュメント）
- [ ] 01. システム構成図
- [ ] 02. RBAC設計書
- [ ] 03. データベース設計書
- [ ] 04. ER図
- [ ] 05. API一覧

### P1（高優先 - 1週間以内）
- [ ] 06. API詳細仕様書（主要エンドポイント）
- [ ] 07. シーケンス図集
- [ ] 09. セキュリティ設計書

### P2（中優先 - 2週間以内）
- [ ] 08. クラス図
- [ ] 11. データフロー図
- [ ] 12. ミドルウェア設計書

### P3（低優先 - 1ヶ月以内）
- [ ] 10. デプロイメント構成図
- [ ] 13. ストレージ設計書
- [ ] 14. AI/LangChain統合設計書

---

## 🎯 対象読者別 推奨閲覧順序

### 新規参加者（開発者）
1. システム構成図 → RBAC設計書 → ER図 → API一覧

### フロントエンド開発者
1. API一覧 → API詳細仕様書 → RBAC設計書 → シーケンス図集

### バックエンド開発者
1. システム構成図 → データベース設計書 → クラス図 → セキュリティ設計書

### インフラ/DevOps担当者
1. デプロイメント構成図 → ストレージ設計書 → セキュリティ設計書

### AI/ML担当者
1. AI/LangChain統合設計書 → システム構成図 → API一覧

---

## 📝 設計書のフォーマット

すべての設計書は以下のフォーマットに従います：

```markdown
# タイトル

**作成日**: YYYY-MM-DD
**最終更新**: YYYY-MM-DD
**バージョン**: X.Y
**対象読者**: [開発者/設計者/etc]

## 概要
[設計書の目的と概要]

## 詳細
[詳細内容（図、テーブル、コード例等を含む）]

## 補足
[注意事項、制限事項、参考リンク等]

## 変更履歴
| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| ... | ... | ... | ... |
```

---

## 🔗 関連ドキュメント

既存のドキュメントとの関係：

- [プロジェクトREADME](../../README.md)
- [ドキュメント目次](../README.md)
- [プロジェクト構造](../02-architecture/01-project-structure.md)
- [レイヤードアーキテクチャ](../02-architecture/02-layered-architecture.md)
- [権限システム再設計](../../permission-system-redesign.md)

---

**最終更新日**: 2025-01-06
**メンテナ**: Claude Code
